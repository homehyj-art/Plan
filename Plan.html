<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>인생 역전! 라이프 카드 게임 & 대시보드</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
body { font-family:'Nanum Pen Script', cursive; background:#ffe4e1; margin:0; padding:0; display:flex; flex-direction:column; align-items:center;}
h1,h2{ text-align:center; }
.card { background:#fff; border-radius:12px; padding:20px; margin:20px; width:300px; box-shadow:0 4px 8px rgba(0,0,0,0.2); transition: transform 0.3s; }
.card:hover { transform: scale(1.05); }
button { margin:5px; padding:10px 15px; border:none; border-radius:8px; background:#ff69b4; color:#fff; cursor:pointer; transition:0.2s;}
button:hover { background:#ff85c1; }
.stats { display:flex; justify-content:space-around; width:80%; margin:10px 0; }
.stat-bar { width:100px; height:20px; background:#ddd; border-radius:10px; overflow:hidden; }
.stat-fill { height:100%; background:#ff69b4; transition: width 0.5s;}
#endScreen, #dashboard { display:none; text-align:center; margin-top:20px; width:90%; max-width:800px;}
table { width:100%; border-collapse:collapse; margin-top:10px;}
th,td { border:1px solid #ccc; padding:5px; text-align:center;}
</style>
</head>
<body>
<h1>🎮 인생 역전! 라이프 카드 게임</h1>

<div class="stats">
  <div>지식<div class="stat-bar"><div id="knowledge" class="stat-fill"></div></div></div>
  <div>체력<div class="stat-bar"><div id="fitness" class="stat-fill"></div></div></div>
  <div>친구<div class="stat-bar"><div id="friendship" class="stat-fill"></div></div></div>
  <div>재능<div class="stat-bar"><div id="talent" class="stat-fill"></div></div></div>
</div>

<div id="cardContainer"></div>

<div id="endScreen">
  <h2>🎉 나만의 엔딩 🎉</h2>
  <p id="endText"></p>
  <button onclick="showDashboard()">관리자 대시보드 보기</button>
</div>

<div id="dashboard">
  <h2>📊 관리자 대시보드</h2>
  <table id="recordsTable">
    <thead>
      <tr>
        <th>시간</th><th>카드</th><th>선택</th><th>지식</th><th>체력</th><th>친구</th><th>재능</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBUKwD2oMtcpMClaNHDNhHoG1ogBYu623k",
  authDomain: "plan-a1107.firebaseapp.com",
  projectId: "plan-a1107",
  storageBucket: "plan-a1107.firebasestorage.app",
  messagingSenderId: "1071905265794",
  appId: "1:1071905265794:web:2e7b46032bbe8ac7f97c9b"
};
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const cards = [
  { id:1, text:"첫 시험이 다가왔어요. 친구가 놀자고 합니다.", choices:[{text:"함께 논다", effects:{knowledge:-5, friendship:10}},{text:"공부한다", effects:{knowledge:10, friendship:-5}}]},
  { id:2, text:"동아리 선택의 날이에요.", choices:[{text:"운동 동아리", effects:{fitness:10}},{text:"독서 동아리", effects:{knowledge:10}}]}
];

let stats = { knowledge:50, fitness:50, friendship:50, talent:50 };
let currentCard = 0;

function updateStats(){
  document.getElementById("knowledge").style.width = stats.knowledge+"%";
  document.getElementById("fitness").style.width = stats.fitness+"%";
  document.getElementById("friendship").style.width = stats.friendship+"%";
  document.getElementById("talent").style.width = stats.talent+"%";
}

function showCard(){
  if(currentCard >= cards.length){
    showEnd();
    return;
  }
  const cardContainer = document.getElementById("cardContainer");
  cardContainer.innerHTML = "";
  const card = document.createElement("div");
  card.className = "card";
  card.innerHTML = `<p>${cards[currentCard].text}</p>`;
  cards[currentCard].choices.forEach((choice, index)=>{
    const btn = document.createElement("button");
    btn.innerText = choice.text;
    btn.onclick = ()=>selectChoice(index);
    card.appendChild(btn);
  });
  cardContainer.appendChild(card);
}

function selectChoice(choiceIndex){
  const choice = cards[currentCard].choices[choiceIndex];
  for(let key in choice.effects){
    stats[key] = Math.min(Math.max(stats[key]+choice.effects[key],0),100);
  }
  updateStats();
  db.collection("gameRecords").add({
    cardId: cards[currentCard].id,
    choice: choice.text,
    stats: {...stats},
    timestamp: new Date()
  });
  currentCard++;
  showCard();
}

function showEnd(){
  document.getElementById("cardContainer").style.display="none";
  document.getElementById("endScreen").style.display="block";
  document.getElementById("endText").innerText = 
    `최종 능력치 - 지식:${stats.knowledge}, 체력:${stats.fitness}, 친구:${stats.friendship}, 재능:${stats.talent}`;
}

function showDashboard(){
  document.getElementById("endScreen").style.display="none";
  document.getElementById("dashboard").style.display="block";
  const tbody = document.querySelector("#recordsTable tbody");
  tbody.innerHTML = "";
  db.collection("gameRecords").orderBy("timestamp","desc").get().then(snapshot=>{
    snapshot.forEach(doc=>{
      const data = doc.data();
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${data.timestamp.toDate().toLocaleString()}</td>
                      <td>${data.cardId}</td>
                      <td>${data.choice}</td>
                      <td>${data.stats.knowledge}</td>
                      <td>${data.stats.fitness}</td>
                      <td>${data.stats.friendship}</td>
                      <td>${data.stats.talent}</td>`;
      tbody.appendChild(tr);
    });
  });
}

updateStats();
showCard();
</script>
</body>
</html>
