import { useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";

const scenarios = [
  {
    title: "중학교 입학!",
    description: "새로운 환경에서 나는 어떤 선택을 할까?",
    choices: [
      { text: "새 친구에게 먼저 말을 건다", effects: { 인간관계: +2 } },
      { text: "조용히 지켜본다", effects: { 지식: +1 } },
    ],
  },
  {
    title: "시험 기간, 친구가 놀자고 한다!",
    description: "나는 어떤 선택을 할까?",
    choices: [
      { text: "같이 논다", effects: { 인간관계: +2, 지식: -1 } },
      { text: "거절하고 공부한다", effects: { 지식: +2, 인간관계: -1 } },
    ],
  },
];

export default function LifeGame() {
  const [step, setStep] = useState(0);
  const [stats, setStats] = useState({ 지식: 0, 체력: 0, 인간관계: 0, 재능: 0 });
  const [showEnding, setShowEnding] = useState(false);

  const current = scenarios[step];

  const handleChoice = (effects) => {
    const newStats = { ...stats };
    for (let key in effects) newStats[key] += effects[key];
    setStats(newStats);

    if (step + 1 < scenarios.length) {
      setStep(step + 1);
    } else {
      setShowEnding(true);
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-b from-pink-100 to-yellow-100 flex flex-col items-center justify-center p-6">
      <h1 className="text-3xl font-bold mb-4">🌟 인생 역전! 라이프 카드 게임</h1>

      {/* 능력치 표시 */}
      <motion.div
        initial={{ opacity: 0, y: -20 }}
        animate={{ opacity: 1, y: 0 }}
        className="grid grid-cols-2 gap-4 mb-6"
      >
        {Object.entries(stats).map(([k, v]) => (
          <motion.div
            key={k}
            animate={{ scale: [1, 1.1, 1] }}
            transition={{ duration: 0.4 }}
            className="bg-white shadow-md rounded-2xl px-4 py-2 text-center"
          >
            {k}: {v}
          </motion.div>
        ))}
      </motion.div>

      <AnimatePresence mode="wait">
        {!showEnding ? (
          <motion.div
            key={step}
            initial={{ opacity: 0, rotateY: 90 }}
            animate={{ opacity: 1, rotateY: 0 }}
            exit={{ opacity: 0, rotateY: -90 }}
            transition={{ duration: 0.6 }}
          >
            <Card className="w-80 bg-white shadow-2xl rounded-2xl">
              <CardContent className="p-6 text-center">
                <h2 className="text-xl font-bold mb-2">{current.title}</h2>
                <p className="mb-4">{current.description}</p>
                {current.choices.map((c, i) => (
                  <motion.div whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }} key={i}>
                    <Button
                      onClick={() => handleChoice(c.effects)}
                      className="w-full mb-2 rounded-xl"
                    >
                      {c.text}
                    </Button>
                  </motion.div>
                ))}
              </CardContent>
            </Card>
          </motion.div>
        ) : (
          <motion.div
            key="ending"
            initial={{ opacity: 0, scale: 0.8 }}
            animate={{ opacity: 1, scale: 1 }}
            transition={{ duration: 0.8 }}
            className="bg-white p-8 rounded-3xl shadow-xl text-center max-w-md"
          >
            <h2 className="text-2xl font-bold mb-4">🎉 나의 인생 결말!</h2>
            <p className="mb-4">너의 선택이 모여 이런 이야기가 되었어!</p>
            <ul className="text-left list-disc ml-6 mb-6">
              {Object.entries(stats).map(([k, v]) => (
                <li key={k}>
                  {k}: {v}점
                </li>
              ))}
            </ul>
            <Button onClick={() => window.location.reload()}>다시 하기</Button>
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
}
