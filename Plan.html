<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>📜 고대 탐험가의 시험 📜</title>
<link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-square-round.css" rel="stylesheet">
<style>
  body {
    margin: 0;
    padding: 0;
    font-family: 'NanumSquareRound', sans-serif;
    background: url('https://img.freepik.com/free-vector/old-parchment-texture-background-with-treasure-map_1340-27202.jpg') no-repeat center center fixed;
    background-size: cover;
    color: #4b3e32;
    overflow-x: hidden;
  }
  .container {
    max-width: 800px;
    margin: auto;
    padding: 40px 20px;
    text-align: center;
  }
  h1 {
    font-family: 'NanumSquareRound', sans-serif;
    font-size: 2.8em;
    color: #2e1d00;
    text-shadow: 2px 2px 5px rgba(255,255,255,0.8);
    animation: fadeIn 2s ease-out;
  }
  .card {
    background: rgba(255, 255, 255, 0.85);
    border-radius: 15px;
    padding: 30px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    animation: slideIn 1s ease;
  }
  .start-screen, .character-selection, .game-screen {
    display: none;
    animation: fadeIn 1.5s ease-out;
  }
  .start-screen.active, .character-selection.active, .game-screen.active {
    display: block;
  }
  .input-group {
    margin-bottom: 20px;
  }
  .input-group label {
    font-size: 1.2em;
    color: #2e1d00;
  }
  .input-group input {
    width: 80%;
    padding: 12px;
    border-radius: 8px;
    border: 2px solid #a38c75;
    background-color: rgba(255,255,255,0.9);
    color: #4b3e32;
    font-family: 'NanumSquareRound', sans-serif;
    font-size: 1.1em;
    margin-top: 8px;
  }
  .character-selection {
    display: flex;
    justify-content: center;
    gap: 40px;
    margin: 40px 0;
  }
  .character {
    cursor: pointer;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    text-align: center;
    position: relative;
    background: rgba(255, 255, 255, 0.7);
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
  }
  .character:hover {
    transform: scale(1.1);
    box-shadow: 0 0 30px #d4af37;
  }
  .character.selected {
      box-shadow: 0 0 30px #b87333;
      transform: scale(1.1);
  }
  .character-emoji {
      font-size: 8em;
      display: block;
      transition: transform 0.3s ease;
  }
  .character p {
    margin-top: 10px;
    font-size: 1.5em;
    color: #2e1d00;
  }
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-top: 30px;
    margin-bottom: 20px;
    font-size: 1em;
  }
  .stat-item {
      background: rgba(255,255,255,0.6);
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #c9b19b;
      animation: slideInLeft 0.8s ease-out;
      text-align: left;
  }
  .stat-icon {
      font-size: 1.3em;
      margin-right: 8px;
      vertical-align: middle;
  }
  .stat-bar {
    width: 100%;
    background: rgba(255,255,255,0.4);
    border-radius: 5px;
    height: 15px;
    overflow: hidden;
    margin-top: 8px;
  }
  .stat-bar-inner {
    height: 100%;
    background: linear-gradient(90deg, #d4af37, #b87333);
    transition: width 0.5s ease;
  }
  #quest-text {
      font-family: 'NanumSquareRound', sans-serif;
      font-size: 1.4em;
      min-height: 80px;
      line-height: 1.6;
      margin-bottom: 25px;
      background-color: rgba(255, 255, 255, 0.7);
      padding: 25px;
      border-radius: 12px;
      border: 2px solid #a38c75;
      text-align: left;
      color: #2e1d00;
  }
  button {
    display: block;
    width: 100%;
    margin: 12px 0;
    padding: 18px;
    font-size: 1.2em;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    background: #a38c75;
    color: #fff;
    font-family: 'NanumSquareRound', sans-serif;
    transition: all 0.3s;
    animation: bounceIn 0.5s ease-out forwards;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
  }
  button:hover {
    background: #b87333;
    box-shadow: 0 0 18px #d4af37;
    transform: translateY(-5px);
  }
  .result-card {
    background: rgba(255, 255, 255, 0.85);
    border-radius: 15px;
    padding: 30px;
    text-align: left;
    animation: zoomIn 1s ease-out;
  }
  .result-card h3 {
    color: #2e1d00;
    border-bottom: 2px solid #2e1d00;
    padding-bottom: 10px;
    font-family: 'NanumSquareRound', sans-serif;
  }
  .career-card-container {
      display: flex;
      justify-content: center;
      gap: 25px;
      margin: 25px 0;
      flex-wrap: wrap;
  }
  .career-card {
      background: rgba(255, 255, 255, 0.5);
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      width: 45%;
      min-width: 250px;
      border: 2px solid #a38c75;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      animation: fadeIn 1s ease-out;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
  }
  .career-card:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px #d4af37;
  }
  .career-emoji {
      font-size: 5.5em;
      display: block;
      margin: 0 auto 12px;
  }
  @keyframes slideIn {
    from { opacity: 0; transform: translateY(100px); }
    to { opacity: 1; transform: translateY(0); }
  }
  @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
  }
  @keyframes bounceIn {
      0% { opacity: 0; transform: scale(0.3); }
      50% { opacity: 1; transform: scale(1.05); }
      70% { transform: scale(0.9); }
      100% { transform: scale(1); }
  }
  @keyframes slideInLeft {
      from { opacity: 0; transform: translateX(-50px); }
      to { opacity: 1; transform: translateX(0); }
  }
  @keyframes zoomIn {
      from { opacity: 0; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1); }
  }
</style>
</head>
<body>

<div class="container">
  <h1>📜 고대 탐험가의 시험 📜</h1>
  <p>전설 속의 고대 지혜를 찾아, 나만의 강점을 발견하세요!</p>

  <div id="start-screen" class="start-screen active card">
    <h2>모험을 시작하기 전, 당신의 정보를 알려주세요.</h2>
    <div class="input-group">
      <label for="student-class">반:</label>
      <input type="text" id="student-class" placeholder="예: 1학년 3반" required>
    </div>
    <div class="input-group">
      <label for="student-name">이름:</label>
      <input type="text" id="student-name" placeholder="예: 김민지" required>
    </div>
    <button onclick="startGame()">모험 시작!</button>
  </div>

  <div id="character-selection" class="character-selection">
    <p>어떤 모험가가 되어볼까?</p>
    <div class="character" id="knight-char" onclick="selectCharacter('knight')">
      <span class="character-emoji">🛡️</span>
      <p>용맹한 기사</p>
    </div>
    <div class="character" id="scholar-char" onclick="selectCharacter('scholar')">
      <span class="character-emoji">🧙‍♂️</span>
      <p>현명한 학자</p>
    </div>
  </div>

  <div id="game-screen" class="game-screen card">
    <div id="character-display">
      <span id="character-emoji-display"></span>
      <p id="character-name-display"></p>
    </div>
    <p id="quest-text"></p>
    <div id="options-container"></div>
    <div class="stats-grid">
      <div class="stat-item"><span class="stat-icon">✍️</span> 언어 지능<div class="stat-bar"><div id="stat-linguistic" class="stat-bar-inner"></div></div></div>
      <div class="stat-item"><span class="stat-icon">🧠</span> 논리-수학 지능<div class="stat-bar"><div id="stat-logical" class="stat-bar-inner"></div></div></div>
      <div class="stat-item"><span class="stat-icon">📐</span> 공간 지능<div class="stat-bar"><div id="stat-spatial" class="stat-bar-inner"></div></div></div>
      <div class="stat-item"><span class="stat-icon">🤸</span> 신체-운동 지능<div class="stat-bar"><div id="stat-bodily" class="stat-bar-inner"></div></div></div>
      <div class="stat-item"><span class="stat-icon">🎵</span> 음악 지능<div class="stat-bar"><div id="stat-musical" class="stat-bar-inner"></div></div></div>
      <div class="stat-item"><span class="stat-icon">🤝</span> 대인관계 지능<div class="stat-bar"><div id="stat-interpersonal" class="stat-bar-inner"></div></div></div>
      <div class="stat-item"><span class="stat-icon">🧘</span> 자기이해 지능<div class="stat-bar"><div id="stat-intrapersonal" class="stat-bar-inner"></div></div></div>
      <div class="stat-item"><span class="stat-icon">🌳</span> 자연 지능<div class="stat-bar"><div id="stat-naturalist" class="stat-bar-inner"></div></div></div>
    </div>
  </div>

  <div id="result-screen" class="game-screen card">
    <h2>🎉 <span id="student-info-result"></span>님의 강점 지능 분석 결과 🎉</h2>
    <div id="result-details" class="result-card">
    </div>
    <button onclick="restartGame()">다시 모험하기</button>
  </div>

</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    const firebaseConfig = {
  apiKey: "AIzaSyBUKwD2oMtcpMClaNHDNhHoG1ogBYu623k",
  authDomain: "plan-a1107.firebaseapp.com",
  projectId: "plan-a1107",
  storageBucket: "plan-a1107.firebasestorage.app",
  messagingSenderId: "1071905265794",
  appId: "1:1071905265794:web:2e7b46032bbe8ac7f97c9b"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

    let studentClass = '';
    let studentName = '';
    let selectedCharacter = '';
    let currentQuestIndex = 0;
    let intelligenceScores = {
      linguistic: 50,
      logical: 50,
      spatial: 50,
      bodily: 50,
      musical: 50,
      interpersonal: 50,
      intrapersonal: 50,
      naturalist: 50
    };

    const characterEmojis = {
      knight: '🛡️',
      scholar: '🧙‍♂️'
    };

    const intelligenceNames = {
        linguistic: { name: '언어 지능', emoji: '✍️' },
        logical: { name: '논리-수학 지능', emoji: '🧠' },
        spatial: { name: '공간 지능', emoji: '📐' },
        bodily: { name: '신체-운동 지능', emoji: '🤸' },
        musical: { name: '음악 지능', emoji: '🎵' },
        interpersonal: { name: '대인관계 지능', emoji: '🤝' },
        intrapersonal: { name: '자기이해 지능', emoji: '🧘' },
        naturalist: { name: '자연 지능', emoji: '🌳' }
    };

    const careers = {
      linguistic: {
        name: "지혜의 기록자 (작가/기자)",
        desc: "고대의 기록을 해독하고 새로운 이야기를 창조하는 데 뛰어납니다. 당신의 글은 시대를 초월하여 사람들에게 지혜를 전할 거예요.",
        emoji: "✍️"
      },
      logical: {
        name: "고대 문명의 설계자 (과학자/프로그래머)",
        desc: "복잡한 고대 유적의 논리적 규칙을 발견하고, 미로를 해독하는 데 재능이 있습니다. 당신의 지성은 잊혀진 문명을 재건할 거예요.",
        emoji: "🧠"
      },
      spatial: {
        name: "환상의 지도 제작자 (디자이너/건축가)",
        desc: "머릿속으로 복잡한 공간을 설계하고, 숨겨진 보물의 위치를 시각적으로 파악하는 데 탁월합니다. 당신의 상상력은 미지의 세계를 탐험할 수 있도록 이끌 거예요.",
        emoji: "📐"
      },
      bodily: {
        name: "고대의 무용가 (무용가/운동선수)",
        desc: "고대 유적의 함정을 피하거나 험준한 산을 오르는 데 능숙합니다. 당신의 몸은 역동적인 모험의 도구가 될 거예요.",
        emoji: "🤸"
      },
      musical: {
        name: "신비한 소리의 연금술사 (음악가/작곡가)",
        desc: "고대 유적에 울려 퍼지는 신비한 멜로디를 이해하고, 마법의 노래를 연주하는 데 뛰어납니다. 당신의 음악은 잠든 유물을 깨울 거예요.",
        emoji: "🎵"
      },
      interpersonal: {
        name: "부족의 협력자 (상담가/리더)",
        desc: "오랜 시간 고립된 부족민들의 마음을 이해하고 그들과 협력하는 데 강점이 있습니다. 당신의 따뜻함은 흩어진 마음을 하나로 모을 거예요.",
        emoji: "🤝"
      },
      intrapersonal: {
        name: "내면의 현자 (심리학자/철학자)",
        desc: "고대의 진리를 탐구하며 자기 자신의 감정과 본질을 깊이 성찰하는 데 능숙합니다. 당신의 통찰력은 모든 시험을 통과하는 원동력이 될 거예요.",
        emoji: "🧘"
      },
      naturalist: {
        name: "야생의 수호자 (환경운동가/생물학자)",
        desc: "고대 숲의 동식물과 교감하고 자연의 징조를 읽는 데 흥미를 느낍니다. 당신의 호기심은 잃어버린 문명을 찾는 열쇠가 될 거예요.",
        emoji: "🌳"
      }
    };

    const quests = [
      {
        text: "고대 유적의 입구에 도착했습니다. 문을 열기 위해 수수께끼를 풀어야 합니다. '말은 없지만 모든 이야기를 품고, 몸은 없지만 모든 길을 보여주는 것'은 무엇일까요?",
        options: [
          { text: "고대 지도책을 펼쳐본다.", effects: { linguistic: 10, spatial: 5 } },
          { text: "고대 상형문자를 분석하여 답을 찾는다.", effects: { linguistic: 10, logical: 5 } },
          { text: "오직 침묵으로 요정의 의도를 파악한다.", effects: { intrapersonal: 10, interpersonal: 5 } },
          { text: "몸으로 무언가를 표현하여 답을 나타낸다.", effects: { bodily: 10, musical: 5 } }
        ]
      },
      {
        text: "첫 번째 시험을 통과하고 유적 내부로 들어섰습니다. 거대한 미로가 나타났습니다. 지도는 없지만, 당신은 어떻게 길을 찾을까요?",
        options: [
          { text: "벽에 새겨진 미세한 식물의 흔적을 따라간다.", effects: { naturalist: 15, spatial: 5 } },
          { text: "자신이 걸어온 경로를 논리적으로 계산하여 길을 되짚어본다.", effects: { logical: 15, spatial: 10 } },
          { text: "몸의 감각을 이용해 균형을 잡고, 직감적으로 가장 안전한 길을 선택한다.", effects: { bodily: 15, intrapersonal: 5 } },
          { text: "천장에 새겨진 별자리 문양을 보고 방향을 잡는다.", effects: { spatial: 10, logical: 5 } }
        ]
      },
      {
        text: "미로를 헤치고 나오자, 낯선 부족이 춤을 추며 축제를 벌이고 있습니다. 그들이 당신에게 춤을 배우자고 제안합니다. 어떻게 반응할까요?",
        options: [
          { text: "부족의 리듬에 맞춰 몸을 흔들며 함께 어울린다.", effects: { bodily: 10, interpersonal: 5, musical: 5 } },
          { text: "춤의 동작을 논리적으로 분석하며 외운다.", effects: { logical: 15, musical: 5 } },
          { text: "혼자 구석에서 조용히 춤의 의미를 생각한다.", effects: { intrapersonal: 10, interpersonal: -5 } },
          { text: "부족민들에게 춤에 대한 이야기를 물어본다.", effects: { linguistic: 10, interpersonal: 10 } }
        ]
      },
      {
        text: "축제에서 보물 지도를 받았습니다. 하지만 지도는 찢어져 있고, 의미를 알 수 없는 그림만 남아있습니다. 당신은 어떻게 지도를 해석할까요?",
        options: [
          { text: "그림의 전체적인 구도를 머릿속으로 재구성하여 지도를 완성한다.", effects: { spatial: 15, logical: 5 } },
          { text: "그림 속의 상징들을 해독하여 숨겨진 의미를 파악한다.", effects: { linguistic: 15, spatial: 10 } },
          { text: "지도의 재질과 냄새를 통해 재료가 어디서 왔는지 추측한다.", effects: { naturalist: 10, logical: 5 } },
          { text: "다른 사람들과 함께 지도를 분석하며 퍼즐을 맞춘다.", effects: { interpersonal: 15, logical: 10 } }
        ]
      },
      {
        text: "지도에 표시된 대로 길을 가던 중, 동굴에 갇힌 노인을 만났습니다. 노인을 어떻게 구출할까요?",
        options: [
          { text: "노인의 이야기를 끝까지 경청하고 마음을 편안하게 해준다.", effects: { interpersonal: 15, linguistic: 5 } },
          { text: "동굴의 구조를 파악하고, 돌을 옮기는 가장 효율적인 방법을 찾는다.", effects: { logical: 10, spatial: 5 } },
          { text: "노인의 불안한 감정에 공감하며 자신만의 위로를 건넨다.", effects: { intrapersonal: 10, interpersonal: 10 } },
          { text: "몸을 이용해 틈새를 찾아보고 노인을 끌어낼 방법을 찾는다.", effects: { bodily: 10, logical: 5 } }
        ]
      },
      {
        text: "노인을 구출하고 보니, 그가 마법의 피리를 건네줍니다. 피리에서는 이상한 소리가 납니다. 당신은 어떻게 피리를 다룰까요?",
        options: [
          { text: "피리 소리의 음계와 리듬을 분석하여 아름다운 멜로디를 만든다.", effects: { musical: 15, logical: 10 } },
          { text: "피리를 불 때 입술과 손가락의 움직임을 연습하며 가장 아름다운 소리를 찾는다.", effects: { bodily: 15, musical: 5 } },
          { text: "피리 소리를 들으며 마음의 평화를 얻으려 노력한다.", effects: { intrapersonal: 15, musical: 5 } },
          { text: "피리 소리를 흉내 내어 자연의 소리와 조화를 이루게 한다.", effects: { naturalist: 10, musical: 10 } }
        ]
      },
      {
        text: "피리의 힘으로 신비로운 숲에 도착했습니다. 숲에는 낯선 언어로 쓰인 비석이 있습니다. 비석의 내용을 어떻게 해독할까요?",
        options: [
          { text: "비석의 문자를 하나하나 분석하여 문법적 규칙을 찾는다.", effects: { linguistic: 20, logical: 5 } },
          { text: "문자의 형태를 통해 전체적인 의미를 추측하고 이미지를 연상한다.", effects: { spatial: 15, linguistic: 10 } },
          { text: "비석에 새겨진 문자의 기원과 역사를 추론한다.", effects: { linguistic: 15, intrapersonal: 5 } },
          { text: "다른 사람에게 도움을 청해 함께 해독한다.", effects: { interpersonal: 15, linguistic: 5 } }
        ]
      },
      {
        text: "숲을 지나니 거대한 폭포가 나타납니다. 폭포 뒤에 숨겨진 비밀 통로를 찾아야 합니다. 당신은 어떻게 통로를 찾을까요?",
        options: [
          { text: "폭포 소리의 음량과 주파수를 분석하여 통로의 위치를 파악한다.", effects: { musical: 15, logical: 10 } },
          { text: "주변의 바위와 식물의 형태를 관찰하며 통로의 단서를 찾는다.", effects: { naturalist: 20, spatial: 5 } },
          { text: "폭포 주변의 공기 흐름이나 물의 진동을 몸으로 느껴본다.", effects: { bodily: 15, intrapersonal: 10 } },
          { text: "폭포의 모습을 머릿속으로 그려보며 지도를 만든다.", effects: { spatial: 15, logical: 5 } }
        ]
      },
      {
        text: "통로를 지나자, 신비로운 연못이 있습니다. 연못에는 당신의 마음을 읽는 거울이 떠 있습니다. 거울은 당신에게 무엇을 비춰줄까요?",
        options: [
          { text: "내가 어떤 사람인지 깊이 생각하고, 거울이 보여주는 나의 내면과 대화한다.", effects: { intrapersonal: 20 } },
          { text: "거울 속의 나에게 나의 꿈과 목표를 명확한 언어로 말해준다.", effects: { linguistic: 15, intrapersonal: 5 } },
          { text: "거울에 비친 나의 모습에서 새로운 영감을 얻는다.", effects: { spatial: 15, intrapersonal: 5 } },
          { text: "거울이 나의 마음을 읽는 원리를 논리적으로 분석한다.", effects: { logical: 15, intrapersonal: 5 } }
        ]
      },
      {
        text: "마지막 시험의 관문은 '마음의 문'입니다. 이 문은 당신이 가장 자신 있는 방법으로 자신의 지혜를 증명해야 열립니다. 당신의 선택은?",
        options: [
          { text: "문지기에게 유창하고 설득력 있는 말로 자신의 지식을 전달한다.", effects: { linguistic: 20, interpersonal: 10 } },
          { text: "복잡한 논리적 퍼즐을 제시하여 문지기의 지성을 시험한다.", effects: { logical: 20, spatial: 10 } },
          { text: "환상적인 춤을 추거나 그림을 그려서 자신의 예술성을 보여준다.", effects: { spatial: 15, bodily: 10, musical: 10 } },
          { text: "문지기의 마음을 움직이는 아름다운 노래를 연주하거나 작곡하여 들려준다.", effects: { musical: 20, interpersonal: 10 } }
        ]
      },
      {
        text: "시험을 통과하자, 한 명의 현자가 당신 앞에 나타납니다. 그는 당신에게 앞으로의 모험에 필요한 조언을 해주겠다고 합니다. 어떤 조언을 구하고 싶나요?",
        options: [
          { text: "내가 앞으로 나아가야 할 길에 대한 명확한 설명을 요청한다.", effects: { linguistic: 15, logical: 5 } },
          { text: "현자가 말하는 조언의 숨겨진 의미를 파악하려 노력한다.", effects: { intrapersonal: 15, linguistic: 5 } },
          { text: "현자가 지도를 그릴 수 있도록 공간적 정보를 제공한다.", effects: { spatial: 10, logical: 10 } },
          { text: "다른 탐험가들과의 관계를 어떻게 발전시킬지에 대해 묻는다.", effects: { interpersonal: 15, intrapersonal: 10 } }
        ]
      },
      {
        text: "당신은 고대 도시의 거리에 섰습니다. 사람들은 활기차게 장사를 하고 이야기를 나누고 있습니다. 당신의 발길을 끄는 곳은 어디인가요?",
        options: [
          { text: "다양한 부족의 언어가 섞인 시끌벅적한 시장.", effects: { linguistic: 15, interpersonal: 10 } },
          { text: "물건의 원리와 작동 방식을 설명하는 발명가의 작업실.", effects: { logical: 15, bodily: 5 } },
          { text: "아름다운 조각상과 건축물이 전시된 박물관.", effects: { spatial: 15, musical: 5 } },
          { text: "다양한 동물과 희귀한 식물이 있는 작은 정원.", effects: { naturalist: 15, bodily: 5 } }
        ]
      },
      {
        text: "밤이 되자 고대 도시의 궁전에서 화려한 무도회가 열립니다. 당신은 무도회에서 어떤 역할을 맡게 될까요?",
        options: [
          { text: "음악에 맞춰 자유롭고 우아한 춤을 선보인다.", effects: { musical: 15, bodily: 10 } },
          { text: "사람들과 이야기를 나누며 모두가 즐거운 분위기를 만든다.", effects: { interpersonal: 20 } },
          { text: "궁전의 구조를 관찰하며 비밀 통로를 찾아본다.", effects: { spatial: 10, logical: 10 } },
          { text: "자신만의 생각에 잠겨 홀로 조용히 분위기를 즐긴다.", effects: { intrapersonal: 15, interpersonal: -5 } }
        ]
      },
      {
        text: "고대 서고에 도착했습니다. 수많은 책 중에서 어떤 책이 당신의 눈길을 사로잡을까요?",
        options: [
          { text: "고대 시와 문학 작품이 가득한 두꺼운 책.", effects: { linguistic: 20 } },
          { text: "신비한 마법 공식과 기하학적 문양이 가득한 책.", effects: { logical: 20 } },
          { text: "전설적인 건축물과 보물 지도가 그려진 책.", effects: { spatial: 20 } },
          { text: "위대한 현자의 명상 기록과 철학이 담긴 책.", effects: { intrapersonal: 20 } }
        ]
      },
      {
        text: "고대 도시 외곽의 정원을 탐험하게 되었습니다. 정원에서 당신의 마음을 가장 편안하게 하는 것은 무엇인가요?",
        options: [
          { text: "희귀한 식물과 동물을 발견하고 관찰하는 것.", effects: { naturalist: 20 } },
          { text: "자연의 소리를 들으며 마음의 평화를 찾는 것.", effects: { musical: 15, intrapersonal: 5 } },
          { text: "정원의 조화로운 배치와 디자인을 감상하는 것.", effects: { spatial: 15, logical: 5 } },
          { text: "바람의 흐름과 풀잎의 움직임을 몸으로 느끼는 것.", effects: { bodily: 15, naturalist: 10 } }
        ]
      },
      {
        text: "위험한 함정들이 가득한 신전으로 들어섰습니다. 어떻게 함정을 피하며 나아갈까요?",
        options: [
          { text: "함정의 작동 원리를 논리적으로 분석하여 해체한다.", effects: { logical: 20, spatial: 10 } },
          { text: "몸의 민첩성을 이용해 빠르게 함정을 통과한다.", effects: { bodily: 20, spatial: 10 } },
          { text: "바닥의 진동을 감지하고 직감적으로 안전한 길을 선택한다.", effects: { intrapersonal: 15, bodily: 15 } },
          { text: "다른 탐험가들과 협력하여 함정을 무력화시킨다.", effects: { interpersonal: 15, logical: 10 } }
        ]
      },
      {
        text: "신전 깊은 곳에서 신비한 힘을 가진 돌을 발견했습니다. 돌은 특정한 소리에만 반응합니다. 어떤 소리를 낼까요?",
        options: [
          { text: "돌의 재질과 형태에 어울리는 소리를 떠올려 연주한다.", effects: { musical: 20 } },
          { text: "다양한 소리를 내어 돌의 반응을 실험하고 기록한다.", effects: { logical: 15, musical: 10 } },
          { text: "돌과 교감하려는 마음으로 조용한 속삭임을 보낸다.", effects: { intrapersonal: 15, interpersonal: 10 } },
          { text: "고대의 기록에서 발견한 마법의 주문을 외운다.", effects: { linguistic: 15, musical: 5 } }
        ]
      },
      {
        text: "신비로운 돌의 힘으로 잠시 시간 여행을 하게 되었습니다. 어떤 시대를 보고 싶나요?",
        options: [
          { text: "위대한 건축가가 살았던 고대 도시의 건축 현장.", effects: { spatial: 20 } },
          { text: "자연이 그대로 보존된 원시 시대의 숲.", effects: { naturalist: 20 } },
          { text: "다양한 부족이 모여 서로의 문화를 교류하는 황금기.", effects: { interpersonal: 20 } },
          { text: "새로운 언어와 문자가 만들어지는 태초의 순간.", effects: { linguistic: 20 } }
        ]
      },
      {
        text: "마지막 시험입니다. 전설의 수호자가 당신의 앞에 서서, 당신의 가장 뛰어난 지혜를 보여달라고 합니다. 당신은 무엇을 선택하겠습니까?",
        options: [
          { text: "정확하고 논리적인 언어로 당신의 모험을 설명한다.", effects: { linguistic: 15, logical: 15 } },
          { text: "수호자의 동작을 분석하여 숨겨진 패턴을 찾고, 완벽하게 따라 한다.", effects: { bodily: 15, logical: 15 } },
          { text: "내면의 목소리에 귀 기울여 수호자의 마음을 읽어낸다.", effects: { intrapersonal: 20, interpersonal: 10 } },
          { text: "주변의 자연물을 이용하여 아름다운 작품을 만들어낸다.", effects: { naturalist: 15, spatial: 15 } }
        ]
      }
    ];

    function startGame() {
      studentClass = document.getElementById('student-class').value;
      studentName = document.getElementById('student-name').value;

      if (studentClass && studentName) {
        document.getElementById('start-screen').classList.remove('active');
        document.getElementById('character-selection').classList.add('active');
      } else {
        alert('반과 이름을 입력해주세요!');
      }
    }

    function selectCharacter(character) {
      selectedCharacter = character;
      document.querySelectorAll('.character').forEach(charDiv => charDiv.classList.remove('selected'));
      document.getElementById(`${character}-char`).classList.add('selected');

      document.getElementById('character-emoji-display').innerText = characterEmojis[selectedCharacter];
      document.getElementById('character-name-display').innerText = studentName;

      setTimeout(() => {
          document.getElementById('character-selection').classList.remove('active');
          document.getElementById('game-screen').classList.add('active');
          loadQuest();
      }, 500);
    }

    function loadQuest() {
      if (currentQuestIndex < quests.length) {
        const quest = quests[currentQuestIndex];
        const questTextElement = document.getElementById('quest-text');
        const fullText = `[${currentQuestIndex + 1}/${quests.length}] ` + quest.text;

        const optionsContainer = document.getElementById('options-container');
        optionsContainer.innerHTML = '';
        
        let i = 0;
        questTextElement.innerText = '';
        const typing = () => {
          if (i < fullText.length) {
            questTextElement.innerHTML += fullText.charAt(i);
            i++;
            setTimeout(typing, 40);
          } else {
            quest.options.forEach((option) => {
              const button = document.createElement('button');
              button.innerText = option.text;
              button.onclick = () => chooseOption(option);
              optionsContainer.appendChild(button);
            });
          }
        };
        typing();
        updateStatsDisplay();
      } else {
        showResult();
      }
    }

    async function chooseOption(option) {
      for (const intel in option.effects) {
        intelligenceScores[intel] = Math.min(100, Math.max(0, intelligenceScores[intel] + option.effects[intel]));
      }
      currentQuestIndex++;

      const buttons = document.querySelectorAll('#options-container button');
      buttons.forEach(button => button.disabled = true);
      
      updateStatsDisplay();
      setTimeout(loadQuest, 800);
    }

    function updateStatsDisplay() {
      for (const intel in intelligenceScores) {
        const statBarInner = document.getElementById(`stat-${intel}`);
        if (statBarInner) {
            statBarInner.style.width = intelligenceScores[intel] + '%';
        }
      }
    }

    async function showResult() {
      document.getElementById('game-screen').classList.remove('active');
      document.getElementById('result-screen').classList.add('active');
      document.getElementById('student-info-result').innerText = `${studentClass} ${studentName}`;

      const sortedIntelligences = Object.entries(intelligenceScores).sort(([, a], [, b]) => b - a);
      const top1 = sortedIntelligences[0];
      const top2 = sortedIntelligences[1];

      const resultDetails = document.getElementById('result-details');
      resultDetails.innerHTML = `
        <p style="text-align:center;">모험을 통해 드러난 당신의 가장 강력한 지능은 다음과 같아요!</p>
        <div class="career-card-container">
            <div class="career-card">
                <span class="career-emoji">${careers[top1[0]].emoji}</span>
                <h3>🥇 1위: ${careers[top1[0]].name}</h3>
                <p>${careers[top1[0]].desc}</p>
            </div>
            <div class="career-card">
                <span class="career-emoji">${careers[top2[0]].emoji}</span>
                <h3>🥈 2위: ${careers[top2[0]].name}</h3>
                <p>${careers[top2[0]].desc}</p>
            </div>
        </div>
        <br>
        <h3 style="margin-top: 20px; text-align: center;">모든 지능 점수:</h3>
        <div style="text-align:center;">
            ${sortedIntelligences.map(([key, score]) => `<p>${intelligenceNames[key].name}: ${score}점</p>`).join('')}
        </div>
      `;

      try {
        await addDoc(collection(db, "gameRecords"), {
          class: studentClass,
          name: studentName,
          intelligences: Object.fromEntries(Object.entries(intelligenceScores).map(([key, value]) => [key, { name: intelligenceNames[key].name, value: value }])),
          timestamp: serverTimestamp()
        });
        console.log("Document successfully written!");
      } catch (e) {
        console.error("Error adding document: ", e);
      }
    }

    function restartGame() {
      studentClass = '';
      studentName = '';
      selectedCharacter = '';
      currentQuestIndex = 0;
      intelligenceScores = {
        linguistic: 50,
        logical: 50,
        spatial: 50,
        bodily: 50,
        musical: 50,
        interpersonal: 50,
        intrapersonal: 50,
        naturalist: 50
      };

      document.getElementById('result-screen').classList.remove('active');
      document.getElementById('character-selection').classList.remove('active');
      document.getElementById('game-screen').classList.remove('active');
      document.getElementById('start-screen').classList.add('active');

      document.getElementById('student-class').value = '';
      document.getElementById('student-name').value = '';

      document.querySelectorAll('.character').forEach(charDiv => charDiv.classList.remove('selected'));
      document.getElementById('character-emoji-display').innerText = '';
      document.getElementById('character-name-display').innerText = '';

      for (const intel in intelligenceScores) {
        const statBarInner = document.getElementById(`stat-${intel}`);
        if (statBarInner) {
            statBarInner.style.width = '0%';
        }
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      for (const intel in intelligenceScores) {
        const statBarInner = document.getElementById(`stat-${intel}`);
        if (statBarInner) {
            statBarInner.style.width = '0%';
        }
      }
    });
</script>
</body>
</html>
