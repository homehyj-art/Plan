<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>나를 찾아 떠나는 모험</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
body {
  margin:0; padding:0;
  font-family: 'Press Start 2P', cursive;
  background: url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e') no-repeat center center fixed;
  background-size: cover;
  color: #f0f8ff;
}
.container {
  max-width: 900px;
  margin: auto;
  padding: 20px;
}
h1 {
  text-align:center;
  font-size:2em;
  color:#ffd700;
  text-shadow: 2px 2px 5px #000;
}
.card {
  background: rgba(0,0,0,0.75);
  border-radius: 15px;
  padding: 20px;
  margin: 20px 0;
  box-shadow: 0 0 25px #000;
  animation: fadeIn 1s ease;
}
button {
  display: block;
  width: 100%;
  margin: 10px 0;
  padding: 10px;
  font-size: 0.8em;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  background: linear-gradient(90deg,#ff8c00,#ffd700);
  color: #000;
  font-family: 'Press Start 2P', cursive;
  transition: transform 0.2s;
}
button:hover { transform: scale(1.05);}
.stats {
  display: flex;
  justify-content: space-around;
  margin: 10px 0;
}
.stat-bar {
  width: 22%;
  background: rgba(255,255,255,0.3);
  border-radius: 5px;
  height: 15px;
  overflow: hidden;
}
.stat-bar-inner {
  height: 100%;
  background: #7CFC00;
}
@keyframes fadeIn {
  from {opacity:0; transform: translateY(50px);}
  to {opacity:1; transform: translateY(0);}
}
</style>
</head>
<body>
<div class="container">
  <h1>🗺️ 나를 찾아 떠나는 모험 🗺️</h1>
  <div class="stats" id="stats">
    <div>
      지식
      <div class="stat-bar"><div class="stat-bar-inner" id="knowledge" style="width:0%"></div></div>
    </div>
    <div>
      체력
      <div class="stat-bar"><div class="stat-bar-inner" id="fitness" style="width:0%"></div></div>
    </div>
    <div>
      우정
      <div class="stat-bar"><div class="stat-bar-inner" id="friendship" style="width:0%"></div></div>
    </div>
    <div>
      재능
      <div class="stat-bar"><div class="stat-bar-inner" id="talent" style="width:0%"></div></div>
    </div>
  </div>
  <div id="cardContainer"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

// Firebase 설정
const firebaseConfig = {
  apiKey: "AIzaSyBUKwD2oMtcpMClaNHDNhHoG1ogBYu623k",
  authDomain: "plan-a1107.firebaseapp.com",
  projectId: "plan-a1107",
  storageBucket: "plan-a1107.firebasestorage.app",
  messagingSenderId: "1071905265794",
  appId: "1:1071905265794:web:2e7b46032bbe8ac7f97c9b"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// 캐릭터 능력치
let stats = { knowledge:0, fitness:0, friendship:0, talent:0 };

// 카드 데이터 (25단계 샘플, 선택지 3~5개)
const cards = [];
for(let i=1;i<=25;i++){
  const choices = [];
  const numChoices = Math.floor(Math.random()*3)+3; // 3~5개 선택지
  for(let j=0;j<numChoices;j++){
    choices.push({
      text:`선택 ${j+1}`,
      stats:{
        knowledge: Math.floor(Math.random()*3),
        fitness: Math.floor(Math.random()*3),
        friendship: Math.floor(Math.random()*3),
        talent: Math.floor(Math.random()*3)
      }
    });
  }
  cards.push({
    id:i,
    title:`퀘스트 ${i}`,
    desc:`전사 캐릭터가 모험 중 퀘스트 ${i}에 도전합니다.`,
    choices: choices
  });
}

let currentCard = 0;

// 능력치 업데이트
function updateStats() {
  document.getElementById('knowledge').style.width = Math.min(stats.knowledge*4,100) + '%';
  document.getElementById('fitness').style.width = Math.min(stats.fitness*4,100) + '%';
  document.getElementById('friendship').style.width = Math.min(stats.friendship*4,100) + '%';
  document.getElementById('talent').style.width = Math.min(stats.talent*4,100) + '%';
}

// 카드 표시
function showCard() {
  if(currentCard >= cards.length){
    document.getElementById('cardContainer').innerHTML = `<h2 style="text-align:center; font-size:1.5em;">모험 종료! 최종 능력치</h2>
    <pre style="background: rgba(0,0,0,0.7); padding:20px; border-radius:10px; font-size:0.6em;">${JSON.stringify(stats,null,2)}</pre>
    <p style="text-align:center;">새로고침하면 다시 모험 가능!</p>`;
    return;
  }
  const card = cards[currentCard];
  const container = document.getElementById('cardContainer');
  container.innerHTML = `
    <div class="card">
      <h2 style="font-size:1.2em;">🗡️ ${card.title}</h2>
      <p>${card.desc}</p>
      ${card.choices.map((c,i)=>`<button onclick="choose(${i})">${c.text}</button>`).join('')}
    </div>
  `;
}

// 선택 처리
window.choose = async function(idx){
  const choice = cards[currentCard].choices[idx];
  for(const key in choice.stats){
    stats[key] += choice.stats[key];
  }
  updateStats();
  // Firestore 저장
  try{
    await addDoc(collection(db,'gameRecords'),{
      cardId: cards[currentCard].id,
      choice: choice.text,
      stats: {...stats},
      timestamp: Date.now()
    });
  }catch(e){
    console.error("Firestore 저장 오류:", e);
  }
  currentCard++;
  showCard();
}

// 초기 시작
showCard();
updateStats();
</script>
</body>
</html>
