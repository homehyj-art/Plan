<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>📜 다중지능 탐험: 고대의 부름</title>
<link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum:wght@400;700&family=Cinzel:wght@700&display=swap" rel="stylesheet">
<style>
/* 변수 및 기본 스타일 */
:root {
    --brown-text: #4a3a2a;
    --gold: #c89a4b;
    --card-bg: rgba(255, 255, 255, 0.85);
    /* 텍스트 가독성을 위한 새로운 변수 */
    --scroll-text: #3c2a1a;
    --main-text: #fff;
    --highlight-text: #fddb83;
}

* {
    box-sizing: border-box;
}

body {
    margin: 0;
    font-family: 'Gowun Dodum', serif;
    background-color: #5d4037; /* 이미지 로딩 전 배경색 */
    background-image: url('https://firebasestorage.googleapis.com/v0/b/gtemp-a8599.appspot.com/o/papyrus-1478204_1280.jpg?alt=media&token=26214300-84c4-42ea-a4b5-65476d0d216a');
    background-repeat: no-repeat;
    background-position: center center;
    background-size: cover;
    background-attachment: fixed;
    color: var(--main-text);
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 20px;
    position: relative;
    overflow: hidden;
    transition: background-image 1s ease-in-out;
}

body::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.4);
    pointer-events: none;
    transition: background-color 2s ease-in-out;
}

.wrap {
    width: 100%;
    max-width: 1200px;
}

.header {
    text-align: center;
    margin-bottom: 20px;
    animation: fadeInDown 1s ease-out;
}

.title {
    font-family: 'Cinzel', serif;
    font-size: clamp(2rem, 5vw, 3.5rem);
    color: var(--gold);
    text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.8);
}

.subtitle {
    font-family: 'Gowun Dodum';
    opacity: 0.9;
    font-size: clamp(1rem, 2vw, 1.3rem);
    color: var(--main-text);
}

/* 레이아웃 */
.layout {
    display: flex;
    gap: 20px;
}

.left, .right {
    transition: all 0.5s ease-out;
}

.left {
    width: 360px;
    animation: fadeInLeft 1s ease-out;
}

.right {
    flex: 1;
    animation: fadeInRight 1s ease-out;
}

/* 카드 UI */
.card {
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(8px);
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
    border: 1px solid rgba(255, 215, 102, 0.15);
}

/* 캐릭터 선택 */
.char-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
}

.char {
    padding: 10px;
    border-radius: 10px;
    background: rgba(0, 0, 0, 0.3);
    text-align: center;
    cursor: pointer;
    border: 1px solid transparent;
    transition: all 0.3s ease;
}

.char:hover {
    transform: translateY(-5px);
    background: rgba(0, 0, 0, 0.5);
    border-color: var(--gold);
}

.char.selected {
    background: rgba(200, 154, 75, 0.3);
    border-color: var(--gold);
    transform: translateY(-5px);
}

/* 폼 요소 */
label {
    display: block;
    color: var(--gold);
    font-weight: 700;
    margin-bottom: 6px;
    font-size: 1.1rem; /* 폰트 사이즈 조정 */
}

input[type=text] {
    width: 100%;
    padding: 12px; /* 패딩 조정 */
    border-radius: 8px;
    border: 1px solid rgba(255, 215, 102, 0.2);
    background: rgba(0, 0, 0, 0.3);
    color: var(--main-text);
    margin-bottom: 10px;
    font-family: 'Gowun Dodum', serif;
    font-size: 1.1rem; /* 폰트 사이즈 조정 */
}

.btn {
    display: inline-flex;
    gap: 8px;
    align-items: center;
    justify-content: center;
    padding: 12px 16px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    background: linear-gradient(145deg, #b38645, #835e2c);
    color: var(--main-text);
    font-weight: bold;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
    width: 100%;
    font-family: 'Gowun Dodum', serif;
    font-size: 1.1rem; /* 폰트 사이즈 조정 */
    transition: all 0.3s ease;
}

.btn:disabled {
    background: #555;
    cursor: not-allowed;
    box-shadow: none;
}

.btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
}

/* 게임 및 퀘스트 영역 */
#game-card {
    background: url('https://firebasestorage.googleapis.com/v0/b/gtemp-a8599.appspot.com/o/ancient_scroll.png?alt=media&token=f0310243-7f3e-4b72-b7e6-23f2113222e4') no-repeat center center;
    background-size: 100% 100%;
    color: var(--scroll-text); /* 스크롤 배경에 맞는 글씨 색상 */
    padding: 50px 60px;
    min-height: 550px;
    position: relative;
    box-shadow: 0 10px 30px rgba(0,0,0,0.6);
}

.quest-header {
    text-align: center;
    margin-bottom: 20px;
}

.quest-header h3 {
    font-family: 'Cinzel', serif;
    color: var(--scroll-text);
    margin: 0;
    font-size: clamp(1.4rem, 2.8vw, 1.8rem); /* 폰트 사이즈 조정 */
}

.quest-text {
    font-size: clamp(1.1rem, 2.4vw, 1.4rem); /* 폰트 사이즈 조정 */
    line-height: 2;
    min-height: 100px;
}

.options {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
    margin-top: 20px;
}

.option {
    padding: 14px; /* 패딩 조정 */
    border-radius: 10px;
    background: rgba(189, 168, 133, 0.3);
    cursor: pointer;
    border: 1px solid rgba(112, 83, 48, 0.3);
    transition: all 0.2s ease;
    text-align: center;
    font-size: clamp(1rem, 2.2vw, 1.2rem); /* 폰트 사이즈 조정 */
    word-break: keep-all;
    user-select: none;
}

.option:hover {
    transform: scale(1.03);
    background: rgba(189, 168, 133, 0.5);
    border-color: var(--brown-text);
}

.option .label {
    font-weight: bold;
}

/* 능력치 통계 */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
    margin-top: 12px;
    color: var(--main-text);
}

.stat {
    background: rgba(0, 0, 0, 0.3);
    padding: 8px;
    border-radius: 8px;
    text-align: center;
}

.bar {
    height: 10px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 6px;
    margin-top: 8px;
    overflow: hidden;
}

.bar-inner {
    height: 100%;
    background: linear-gradient(90deg, var(--gold), #e6b873);
    width: 0%;
    transition: width 0.6s ease-in-out;
}

/* 결과 영역 */
.result-content {
    color: var(--scroll-text); /* 스크롤 배경에 맞는 글씨 색상 */
    text-align: center;
}

.result-content h3 {
    font-family: 'Cinzel', serif;
    color: var(--scroll-text);
}

/* 애니메이션 */
@keyframes fadeInDown {
    from { opacity: 0; transform: translateY(-30px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes fadeInLeft {
    from { opacity: 0; transform: translateX(-50px); }
    to { opacity: 1; transform: translateX(0); }
}

@keyframes fadeInRight {
    from { opacity: 0; transform: translateX(50px); }
    to { opacity: 1; transform: translateX(0); }
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.spinner {
    display: none;
    border: 4px solid rgba(255, 255, 255, 0.3);
    border-top: 4px solid var(--gold);
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: spin 1s linear infinite;
    margin: 0 auto;
}

/* 반응형 디자인 */
@media(max-width:900px) {
    .layout {
        flex-direction: column;
    }

    .left {
        width: 100%;
    }

    #game-card {
        padding: 30px;
    }
}
</style>
</head>
<body>

<!-- 오디오 파일은 Mixkit에서 가져왔습니다 -->
<audio id="bgm" src="https://assets.mixkit.co/sfx/preview/mixkit-calm-music-2200.mp3" loop></audio>
<audio id="sfx-turn" src="https://assets.mixkit.co/sfx/preview/mixkit-game-click-1110.mp3"></audio>

<div class="wrap">
  <div class="header">
    <div class="title">Ancient Calling</div>
    <div class="subtitle">나의 다중지능을 찾아 떠나는 모험</div>
  </div>

  <div class="layout">
    <div class="left">
      <div class="card">
        <label>모험가 이름</label>
        <input id="input-name" type="text" placeholder="예: 김민준" />
        <label>소속 (반)</label>
        <input id="input-class" type="text" placeholder="예: 1학년 3반" />
        <label>여정을 함께할 동료</label>
        <div id="char-row" class="char-row">
          <div class="char" data-id="prince"><div class="emoji">🤴</div><div class="name">용감한 왕자</div></div>
          <div class="char" data-id="princess"><div class="emoji">👸</div><div class="name">지혜로운 공주</div></div>
          <div class="char" data-id="warrior"><div class="emoji">⚔️</div><div class="name">강인한 전사</div></div>
          <div class="char" data-id="wizard"><div class="emoji">🔮</div><div class="name">신비한 마법사</div></div>
        </div>
        <div style="margin-top:20px;">
          <button id="btn-start" class="btn" disabled>
            <span id="start-btn-text">▶ 모험 시작하기</span>
            <div id="start-btn-spinner" class="spinner"></div>
          </button>
        </div>
      </div>

      <div id="stats-panel" class="card" style="margin-top:12px; display:none;">
          <div id="stats" class="stats-grid"></div>
      </div>
    </div>

    <div class="right">
      <div id="game-card" class="card">
        <div id="pre-game">
          <div style="text-align:center; padding-top: 80px;">
            <h3 style="font-family:'Cinzel', serif; color: var(--scroll-text);">📜 모험의 서막</h3>
            <p style="font-size: 1.2rem; line-height: 1.8;">이름과 소속을 적고, 여정을 함께할 동료를 선택하세요.<br>당신의 선택이 모여 미래의 길을 밝혀줄 것입니다.<br>이제, 고대의 부름에 응답할 시간입니다.</p>
          </div>
        </div>

        <div id="game-area" style="display:none">
          <div class="quest-header">
            <h3 id="quest-title"></h3>
          </div>
          <div id="quest-text" class="quest-text"></div>
          <div id="options" class="options"></div>
        </div>
        
        <div id="result-area" style="display:none; padding-top: 50px;">
          <div class="result-content" id="result-content"></div>
          <button id="btn-restart" class="btn" style="max-width:300px; margin: 20px auto 0;">🔄 새로운 모험 시작하기</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// 전역 변수 및 상수 설정
const sounds = {
    bgm: document.getElementById('bgm'),
    turn: document.getElementById('sfx-turn'),
};
sounds.bgm.volume = 0.2; // BGM 볼륨 조절

// HTML 요소 선택을 위한 헬퍼 함수
const el = id => document.getElementById(id);

// 게임 데이터: 기본 점수 및 플레이어 상태
const baseScores = {linguistic:50,logical:50,spatial:50,bodily:50,musical:50,interpersonal:50,intrapersonal:50,naturalist:50};
let scores = {};
let player = {name:'',clazz:'',charId:'',questIndex:0};
let loading = false;

/* ====== 퀘스트 데이터 (서사 강화 버전) ====== */
function q(title, text, a, b, c, d){ return { title, text, options:[a,b,c,d] }; }
function opt(text, effects){ return {t:text, e:effects}; }

const quests = {
  prince: [
    q("왕의 서신", "먼지 쌓인 서고에서 아버지의 흔적이 담긴 낡은 편지를 발견했다. '진정한 왕의 자격은 왕관이 아닌, 백성을 비추는 빛에 있나니. 그 빛을 따라가거라.' 이 수수께끼 같은 유언의 실마리는 어디서부터 찾아야 할까?",
      opt('📜 편지에 쓰인 단어들의 상징적 의미를 파고들어 분석한다.',{linguistic:14}),
      opt('🗺️ 편지에 남은 희미한 지도의 흔적을 따라 직접 현장으로 향한다.',{bodily:12,spatial:6}),
      opt('👥 편지를 마지막으로 만졌을 법한 왕궁의 오랜 신하를 찾아가 대화한다.',{interpersonal:12,logical:6}),
      opt('🌿 편지지에서 희미하게 나는 풀 향기를 단서로, 특정 지역의 식생을 조사한다.',{naturalist:8,spatial:6})
    ),
    q("불안한 소문", "백성들 사이에 퍼지는 불안한 소문이 왕국의 평화를 위협하고 있다. 소문의 근원을 파악하고 해결해야 한다. 어떻게 할 것인가?",
      opt('🗣️ 사람들의 이야기를 경청하며 소문의 시작점을 파악한다.', {interpersonal:14, intrapersonal: 6}),
      opt('🔢 소문의 확산 속도와 패턴을 분석하여 논리적으로 대응한다.', {logical:12, linguistic: 6}),
      opt('👣 소문의 발원지로 알려진 장소를 직접 찾아가 현장을 조사한다.', {bodily:10, spatial: 8}),
      opt('🎶 소문을 잠재울 평화의 노래를 작곡하여 백성들에게 들려준다.', {musical:14})
    ),
    q("고대 유물", "수수께끼의 힘을 가진 고대 유물이 숨겨진 동굴을 발견했다. 유물을 얻으려면 복잡한 수수께끼를 풀어야 한다. 어떤 방법으로 접근할 것인가?",
      opt('📖 유물에 새겨진 고대 언어를 번역하여 해법을 찾는다.', {linguistic:12, logical: 8}),
      opt('🧩 유물의 복잡한 기계 장치와 패턴을 분석하여 작동 원리를 파악한다.', {logical:14, spatial: 8}),
      opt('✊ 동굴의 지형을 탐색하고 신체적인 능력을 활용해 유물을 확보한다.', {bodily:12, spatial: 6}),
      opt('🧘‍♀️ 유물의 진동과 기운을 느끼며 마음의 눈으로 봉인을 해제한다.', {intrapersonal:14})
    ),
    q("어둠의 그림자", "왕국을 덮친 어둠의 그림자가 숲을 병들게 하고 있다. 숲의 생명력을 되찾아줘야 한다. 어떻게 할 것인가?",
      opt('🌳 숲속의 식물과 동물들과 교감하며 병의 원인을 파악한다.', {naturalist:14, interpersonal: 8}),
      opt('🪄 그림자의 마법적 패턴을 분석해 봉인을 풀어낼 주문을 찾는다.', {logical:12, musical: 6}),
      opt('⚔️ 그림자 자체를 물리적인 힘으로 제압하여 숲을 구한다.', {bodily:14}),
      opt('✍️ 숲의 변화를 기록하며 해결책을 찾아낸다.', {linguistic:10, naturalist: 6})
    ),
    q("길 잃은 여행자", "길을 잃고 헤매는 여행자를 만났다. 그는 당신에게 신비한 수수께끼를 건네며 길을 알려달라고 한다. 어떻게 할 것인가?",
      opt('🗣️ 여행자의 말을 경청하고, 그의 심리 상태를 이해하며 조언한다.', {interpersonal:14, linguistic: 6}),
      opt('🧭 여행자의 목적지까지의 지도를 직접 그려주며 길을 안내한다.', {spatial:12, interpersonal: 6}),
      opt('🤔 수수께끼를 논리적으로 분석하여 해답을 찾아낸다.', {logical:12}),
      opt('🤝 함께 길을 떠나며 몸짓과 행동으로 소통한다.', {bodily:10, interpersonal: 8})
    ),
    q("신비한 연못", "오래된 연못가에서 아름다운 멜로디가 들려온다. 멜로디의 정체를 파악하고, 그에 담긴 힘을 깨우려 한다.",
      opt('🎵 멜로디의 리듬과 화음을 분석하여 악보로 옮겨 적는다.', {musical:16, logical: 6}),
      opt('🌊 연못 주변의 자연환경을 조사하여 멜로디의 근원을 찾는다.', {naturalist:12, spatial: 6}),
      opt('🧘‍♀️ 멜로디에 귀 기울이며 내면의 감정을 탐색하고 그 의미를 이해한다.', {intrapersonal:12, musical: 8}),
      opt('🎤 연못의 멜로디에 화답하는 노래를 불러 연못의 힘을 깨운다.', {musical:14, interpersonal: 8})
    )
  ],
  princess: [
    q("비밀의 지도", "어릴 적, 할머니께서 '세상을 밝힐 영원의 빛'이 숨겨진 곳이라며 낡은 지도를 주셨다. 이제 그 의미를 찾아 떠날 시간. 지도의 첫 번째 표식은 '고요의 정원'을 가리키고 있다. 어떻게 그곳을 찾아갈까?",
      opt('📜 지도의 고대 상형문자를 해독하여 정확한 위치를 파악한다.',{linguistic:14}),
      opt('🧭 지도의 지형과 실제 산맥의 흐름을 대조하며 길을 찾는다.',{spatial:14}),
      opt('🗣️ '고요의 정원'에 대한 전설을 아는 마을 현자를 찾아가 조언을 구한다.',{interpersonal:12}),
      opt('🌸 지도에 그려진 특별한 꽃을 찾아, 그 꽃이 피는 곳으로 향한다.',{naturalist:12})
    ),
    q("마음의 거울", "오래된 마법의 거울이 당신의 가장 깊은 불안을 비추고 있다. 이 거울을 통해 내면의 힘을 깨우려면 어떻게 해야 할까?",
      opt('🤔 거울에 비친 불안의 원인을 논리적으로 분석한다.', {logical:12, intrapersonal: 8}),
      opt('✍️ 거울을 보며 떠오르는 감정과 생각을 글로 기록한다.', {linguistic:12, intrapersonal: 8}),
      opt('🧘‍♀️ 조용히 눈을 감고 거울이 보내는 감정의 파동을 느낀다.', {intrapersonal:14}),
      opt('👣 거울에서 한 발짝 떨어져 내 모습과 거리를 두는 연습을 한다.', {bodily:10, intrapersonal: 8})
    ),
    q("궁정의 음모", "궁정 내에서 당신을 해치려는 음모가 꾸며지고 있다. 이 위기를 어떻게 헤쳐 나갈 것인가?",
      opt('🔍 정보를 수집하고, 증거를 논리적으로 조합하여 음모의 주동자를 밝혀낸다.', {logical:14, linguistic: 6}),
      opt('👥 주변 사람들의 심리를 파악하고, 신뢰할 수 있는 동료를 모은다.', {interpersonal:16}),
      opt('🏃‍♀️ 직접 몸을 숨겨 음모를 피하고, 반격의 기회를 노린다.', {bodily:12, spatial: 6}),
      opt('🤫 음모가 드러나기 전에 먼저 그들의 약점을 찾아내어 설득한다.', {interpersonal:14, linguistic: 8})
    ),
    q("미로의 숲", "마법에 걸린 숲에 갇혔다. 숲은 끊임없이 형태를 바꾸는 미로가 되어 길을 찾기 어렵다.",
      opt('🎼 숲에서 들려오는 신비한 새소리의 음계를 분석하여 길을 찾는다.', {musical:14, logical: 6}),
      opt('� 숲의 식물들과 교감하여 길을 물어본다.', {naturalist:14}),
      opt('🌌 숲의 패턴을 머릿속에 시각화하며 길을 찾는다.', {spatial:16}),
      opt('🗺️ 지형을 파악하고 돌이나 나뭇가지로 이정표를 만들어 길을 기록한다.', {spatial:12, logical: 8})
    ),
    q("잊혀진 전설", "오래된 전설이 담긴 책을 발견했다. 이 책은 잊혀진 마법에 대한 단서를 담고 있지만, 암호로 잠겨 있다. 이 암호를 어떻게 풀 것인가?",
      opt('📜 암호문의 문장 구조와 문법을 분석하여 의미를 유추한다.', {linguistic:14, logical: 8}),
      opt('🧘‍♀️ 암호에 집중하여 내면의 직관으로 해답을 찾아낸다.', {intrapersonal:14}),
      opt('👥 마을의 나이 많은 학자를 찾아가 함께 암호를 해독한다.', {interpersonal:12, linguistic: 6}),
      opt('🎶 책의 리듬과 멜로디를 찾아내어 암호와 연결시킨다.', {musical:14, logical: 6})
    ),
    q("위기의 정원", "마법의 정원이 시들어가고 있다. 이 정원을 되살리려면 정원의 심장부에 있는 '생명의 씨앗'을 찾아야 한다.",
      opt('🌱 정원 식물들의 생장 패턴을 관찰하고 병든 원인을 분석한다.', {naturalist:14, logical: 8}),
      opt('👣 정원의 복잡한 지형을 탐험하며 씨앗이 숨겨진 곳을 찾아낸다.', {spatial:14, bodily: 8}),
      opt('🗣️ 정원 관리인에게 정원의 역사와 특징에 대해 물어본다.', {interpersonal:12, linguistic: 8}),
      opt('💧 정원의 흙과 물의 미세한 성분을 분석하여 최적의 환경을 만든다.', {logical:14, naturalist: 8})
    )
  ],
  warrior: [
    q("사냥꾼의 시험", "고대 전사의 묘지에 도착했다. 이곳을 통과하려면 사냥꾼의 시험을 통과해야 한다. 시험의 내용은 다음과 같다: '눈에 보이지 않는 짐승을 잡아라.' 어떻게 할 것인가?",
      opt('👣 발자국과 흔적을 추적하며 짐승의 이동 경로를 예측한다.', {bodily:14, logical: 6}),
      opt('🧘‍♀️ 고요히 앉아 짐승의 기운을 느끼며 위치를 파악한다.', {intrapersonal:14, spatial: 6}),
      opt('🎶 특정한 리듬의 북소리를 내어 짐승을 유인한다.', {musical:12, logical: 8}),
      opt('🌳 주변의 나뭇가지와 돌을 이용해 함정을 만들어 짐승을 가둔다.', {naturalist:12, spatial: 8})
    ),
    q("무너진 성벽", "마을을 지키던 성벽이 거대한 괴물에 의해 무너졌다. 무너진 성벽을 재건하고, 괴물을 막아야 한다. 어떻게 할 것인가?",
      opt('💪 괴물의 공격 패턴을 파악하고 신체적인 능력을 활용해 괴물을 무찌른다.', {bodily:16}),
      opt('🗺️ 성벽의 설계도를 분석하고, 가장 효율적인 재건 계획을 세운다.', {spatial:14, logical: 8}),
      opt('🗣️ 무너진 성벽의 잔해 속에서 새로운 무기를 만들어 낸다.', {naturalist:10, bodily: 8}),
      opt('🤝 마을 사람들을 설득하고, 각자의 재능을 활용하여 함께 성벽을 재건한다.', {interpersonal:14, logical: 6})
    ),
    q("전쟁의 노래", "전쟁의 긴장감으로 병사들의 사기가 바닥으로 떨어졌다. 병사들의 사기를 북돋아 승리를 이끌어내야 한다.",
      opt('🎶 승리의 노래를 작곡하여 병사들에게 들려준다.', {musical:16, interpersonal: 8}),
      opt('🗣️ 병사들에게 격려와 용기를 주는 연설을 한다.', {linguistic:14, interpersonal: 8}),
      opt('💪 직접 선봉에 서서 병사들에게 용맹함을 보여준다.', {bodily:14}),
      opt('🧘‍♀️ 내면의 고통과 불안을 다스리며 병사들의 마음을 이해한다.', {intrapersonal:14, interpersonal: 8})
    ),
    q("고대 무덤", "전설의 무기가 숨겨진 고대 무덤에 들어섰다. 무덤은 정교한 함정으로 가득 차 있다. 무기를 얻으려면 어떻게 해야 할까?",
      opt('👣 함정의 패턴을 분석하고, 뛰어난 신체 능력으로 함정을 피한다.', {bodily:14, logical: 8}),
      opt('🗺️ 무덤의 지형을 머릿속에 시각화하여 가장 안전한 경로를 찾는다.', {spatial:16}),
      opt('💡 무덤의 벽에 새겨진 문구를 해독하여 함정의 비밀을 알아낸다.', {linguistic:12, logical: 8}),
      opt('🧘‍♀️ 무덤의 기운을 느끼며 함정의 위치를 감지한다.', {intrapersonal:12, spatial: 8})
    ),
    q("잃어버린 식량", "갑작스러운 가뭄으로 식량이 부족해졌다. 굶주린 백성들을 위해 식량을 확보해야 한다.",
      opt('🌾 숲으로 들어가 식용 가능한 식물을 찾아낸다.', {naturalist:16, spatial: 6}),
      opt('🗣️ 다른 마을의 촌장을 찾아가 식량 지원을 요청한다.', {interpersonal:14, linguistic: 6}),
      opt('💪 직접 사냥을 나서서 식량을 확보한다.', {bodily:14, spatial: 8}),
      opt('📊 식량의 소비 속도와 남은 식량을 계산하여 배급량을 조절한다.', {logical:14, interpersonal: 8})
    ),
    q("용의 둥지", "전설의 용이 잠들어 있는 둥지를 발견했다. 용을 깨우지 않고 둥지에 있는 보물을 가져와야 한다.",
      opt('🗺️ 둥지의 구조를 파악하고, 용의 시야와 움직임을 피해 보물을 확보한다.', {spatial:14, bodily: 8}),
      opt('🎶 용을 잠재울 자장가를 불러 용이 깨어나지 못하게 한다.', {musical:16}),
      opt('⚔️ 용의 둥지에 있는 보물을 논리적으로 분석하여 어떤 보물이 가장 가치 있는지 파악한다.', {logical:12, linguistic: 6}),
      opt('🤝 동료들과 협력하여 용의 주의를 분산시키고 보물을 가져온다.', {interpersonal:14, bodily: 8})
    )
  ],
  wizard: [
    q("고대의 주문", "오래된 마법서에서 강력한 주문을 발견했다. 하지만 주문은 암호로 잠겨 있다. 이 암호를 어떻게 풀 것인가?",
      opt('📜 암호문에 숨겨진 언어적 패턴을 분석하여 주문을 해독한다.', {linguistic:16, logical: 8}),
      opt('🧩 암호의 논리적 규칙을 찾아내어 퍼즐을 해결하듯 해독한다.', {logical:16, intrapersonal: 8}),
      opt('🧘‍♀️ 눈을 감고 주문의 기운을 느끼며 내면의 목소리에 귀 기울인다.', {intrapersonal:14}),
      opt('🎶 주문에 어울리는 멜로디를 찾아내어 암호를 해제한다.', {musical:14, linguistic: 6})
    ),
    q("하늘의 별자리", "갑자기 하늘의 별자리가 혼란에 빠졌다. 이 혼란을 바로잡고, 별자리에 숨겨진 예언을 해독해야 한다.",
      opt('🌌 별자리의 위치와 패턴을 분석하여 혼란의 원인을 밝혀낸다.', {spatial:16, logical: 8}),
      opt('✍️ 별자리에 대한 예언을 글로 쓰고, 그 의미를 심층적으로 탐구한다.', {linguistic:14, intrapersonal: 8}),
      opt('🗣️ 별자리를 연구하는 다른 마법사들을 찾아가 함께 해결책을 모색한다.', {interpersonal:14, logical: 6}),
      opt('🌱 별자리의 변화가 지상의 자연에 미치는 영향을 관찰한다.', {naturalist:12, spatial: 8})
    ),
    q("마법의 거울", "마법의 거울이 깨져 조각났다. 이 조각을 다시 맞추려면 조각에 담긴 기억들을 되살려야 한다.",
      opt('🧘‍♀️ 조각에 손을 대고 내면의 힘을 집중해 기억을 되살린다.', {intrapersonal:16}),
      opt('🧩 조각의 형태와 그림을 맞춰 거울을 재구성한다.', {spatial:14, logical: 8}),
      opt('🤝 주변의 사람들을 설득해 조각을 찾아달라고 부탁한다.', {interpersonal:12, bodily: 8}),
      opt('🎶 조각에 담긴 멜로디를 따라 노래를 부르며 기억을 소환한다.', {musical:14, intrapersonal: 8})
    ),
    q("용의 그림자", "마을을 덮친 용의 그림자가 사람들을 공포에 떨게 한다. 그림자를 몰아내고 평화를 되찾아야 한다.",
      opt('🔥 용의 그림자를 물리적인 힘으로 제압하기 위해 강력한 주문을 사용한다.', {bodily:14, logical: 8}),
      opt('🗺️ 그림자의 움직임을 파악하고, 약점을 찾아낼 마법 지도를 만든다.', {spatial:14, logical: 8}),
      opt('🗣️ 사람들에게 용기를 주는 말을 건네며 그림자에 맞설 힘을 불어넣는다.', {interpersonal:14, linguistic: 8}),
      opt('🌳 숲속의 고대 정령을 찾아가 그림자를 물리칠 방법을 물어본다.', {naturalist:12, intrapersonal: 8})
    ),
    q("시든 숲", "마법의 숲이 시들어가고 있다. 숲의 생명력을 되살려야 한다.",
      opt('🧪 숲의 흙과 물을 분석하여 원인을 찾고, 마법 약을 제조한다.', {logical:14, naturalist: 8}),
      opt('🌱 숲의 식물들과 교감하여 숲의 고통을 이해하고 치유한다.', {naturalist:16}),
      opt('🎶 숲의 멜로디를 듣고, 숲에 생명력을 불어넣을 노래를 부른다.', {musical:14, spatial: 6}),
      opt('🧘‍♀️ 숲의 기운과 내면의 기운을 연결하여 숲을 치유한다.', {intrapersonal:14, naturalist: 8})
    ),
    q("마법사의 탑", "고대 마법사의 탑에 들어가려면 복잡한 수수께끼를 풀어야 한다. 탑의 문에는 다음과 같은 문구가 새겨져 있다: '마음을 들여다보라. 그리고 노래하라.'",
      opt('🧘‍♀️ 내면의 깊은 곳을 탐색하여 자신에 대한 해답을 찾는다.', {intrapersonal:16}),
      opt('🎵 탑의 문에 새겨진 문구를 멜로디로 바꾸어 노래한다.', {musical:14, linguistic: 6}),
      opt('💡 문구의 논리적 의미를 분석하여 해답을 찾아낸다.', {logical:12, intrapersonal: 8}),
      opt('🗣️ 다른 마법사들의 조언을 참고하여 수수께끼를 해결한다.', {interpersonal:12, linguistic: 8})
    )
  ]
};

// 캐릭터 선택 핸들러
document.querySelectorAll('.char').forEach(char => {
    char.addEventListener('click', () => {
        document.querySelectorAll('.char').forEach(c => c.classList.remove('selected'));
        char.classList.add('selected');
        player.charId = char.dataset.id;
        checkCanStart();
    });
});

// 이름 및 클래스 입력 핸들러
document.querySelectorAll('#input-name, #input-class').forEach(input => {
    input.addEventListener('input', checkCanStart);
});

function checkCanStart() {
    const name = el('input-name').value.trim();
    const clazz = el('input-class').value.trim();
    el('btn-start').disabled = !(name && clazz && player.charId);
}

// 게임 시작 핸들러
el('btn-start').addEventListener('click', async () => {
    if (loading) return;

    sounds.bgm.play();
    loading = true;
    el('start-btn-text').style.display = 'none';
    el('start-btn-spinner').style.display = 'block';

    player.name = el('input-name').value.trim();
    player.clazz = el('input-class').value.trim();
    player.questIndex = 0;
    scores = {...baseScores};

    // 지연 효과 추가
    await new Promise(r => setTimeout(r, 1000));

    el('pre-game').style.display = 'none';
    el('game-area').style.display = 'block';
    el('stats-panel').style.display = 'block';
    
    loading = false;
    el('start-btn-text').style.display = 'block';
    el('start-btn-spinner').style.display = 'none';

    renderQuest();
});

// 퀘스트 렌더링
function renderQuest(){
    sounds.turn.play();
    const currentQuest = quests[player.charId][player.questIndex];
    if (!currentQuest) {
        showResult();
        return;
    }
    
    el('quest-title').innerText = currentQuest.title;
    el('quest-text').innerText = currentQuest.text;

    const optionsDiv = el('options');
    optionsDiv.innerHTML = '';
    currentQuest.options.forEach((opt, index) => {
        const btn = document.createElement('div');
        btn.className = 'option';
        btn.innerText = opt.t;
        btn.onclick = () => handleOption(opt.e);
        optionsDiv.appendChild(btn);
    });

    renderStats();
}

// 옵션 선택 핸들러
function handleOption(effects){
    for (const key in effects) {
        scores[key] = Math.min(100, scores[key] + effects[key]);
    }

    player.questIndex++;
    renderQuest();
}

// 능력치 통계 렌더링
function renderStats(){
    const root = el('stats');
    root.innerHTML = '';
    const mapNames = {linguistic:'언어 지능',logical:'논리-수학 지능',spatial:'공간 지능',bodily:'신체-운동 지능',musical:'음악 지능',interpersonal:'대인관계 지능',intrapersonal:'자기이해 지능',naturalist:'자연친화 지능'};
    Object.keys(scores).forEach(k => {
        const score = Math.min(100, Math.max(0, scores[k]));
        const box = document.createElement('div');
        box.className = 'stat';
        box.innerHTML = `
            <div style="font-weight:bold;color:var(--gold); font-size: 0.9rem;">${mapNames[k]}</div>
            <div class="bar"><div class="bar-inner" style="width:${score}%"></div></div>
        `;
        root.appendChild(box);
    });
}

// 결과 화면 보여주기
function showResult(){
    el('game-area').style.display = 'none';
    el('stats-panel').style.display = 'none';
    el('result-area').style.display = 'block';

    const entries = Object.entries(scores).sort((a,b)=>b[1]-a[1]);
    const top1 = entries[0][0];
    const top2 = entries[1][0];
    const mapNames = {linguistic:'언어 지능',logical:'논리-수학 지능',spatial:'공간 지능',bodily:'신체-운동 지능',musical:'음악 지능',interpersonal:'대인관계 지능',intrapersonal:'자기이해 지능',naturalist:'자연친화 지능'};
    
    const resultHTML = `
        <h3>📜 모험의 결과</h3>
        <p><strong>${player.name}</strong>(${player.clazz})의 여정은 마무리되었습니다.</p>
        <p style="font-size:1.2rem; margin-top: 20px;">
            당신은 모험을 통해 <strong><span style="color:var(--gold);font-weight:bold;">${mapNames[top1]}</span></strong>와 <strong><span style="color:var(--gold);font-weight:bold;">${mapNames[top2]}</span></strong>의 지능이 가장 뛰어남을 발견했습니다.
        </p>
        <p style="font-size:1.1rem; line-height: 1.6; margin-top: 20px;">
            ${mapNames[top1]}는 복잡한 문제를 해결하고 패턴을 파악하는 데 뛰어나며, ${mapNames[top2]}는...
        </p>
    `;
    el('result-content').innerHTML = resultHTML;

    // 다시 시작하기 버튼
    el('btn-restart').onclick = () => {
        location.reload();
    };
}
</script>
</body>
</html>
