<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>아틀란티스의 지혜: 나의 진로 모험</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #0d1a2a;
            color: #e0e0e0;
            margin: 0;
            padding: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            text-align: center;
        }
        
        #game-container {
            width: 90%;
            max-width: 1200px;
            height: 90vh;
            max-height: 800px;
            background: rgba(2, 6, 17, 0.7);
            border: 5px solid #ffcc00;
            border-radius: 20px;
            box-shadow: 0 0 50px rgba(255, 204, 0, 0.5);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
        }

        #bg-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
            opacity: 0.3;
        }
        
        h1, h2 {
            color: #ffcc00;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            font-size: 2.5em;
            margin-bottom: 20px;
        }
        
        #start-screen, #character-select-screen, #quest-screen, #result-screen, #dashboard-screen {
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }
        
        .visible {
            display: flex !important;
            opacity: 1 !important;
        }
        
        .button {
            padding: 15px 30px;
            font-size: 1.2em;
            cursor: pointer;
            border: 2px solid #ffcc00;
            border-radius: 10px;
            background: linear-gradient(45deg, #0f2027, #2c5364);
            color: #fff;
            margin: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px #ffcc00;
        }
        
        #character-list {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .character-card {
            background-color: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            width: 180px;
            text-align: center;
        }
        
        .character-card img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 3px solid #ffcc00;
            object-fit: cover;
        }
        
        .character-card.selected {
            border-color: #00ff00;
            box-shadow: 0 0 20px #00ff00;
            transform: scale(1.1);
        }
        
        .character-card h3 {
            color: #ffcc00;
            margin: 10px 0;
        }
        
        .character-card p {
            font-size: 0.9em;
            color: #ccc;
        }

        #quest-text {
            font-size: 1.5em;
            margin: 20px;
            text-align: center;
        }

        #quest-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 80%;
        }

        .quest-option {
            padding: 15px;
            font-size: 1.1em;
            border: 1px solid #aaa;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
            background-color: #2b2b2b;
        }
        
        .quest-option:hover {
            background-color: #444;
            transform: translateY(-3px);
        }
        
        #progress-bar-container {
            width: 80%;
            background-color: #555;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 20px;
        }

        #progress-bar {
            height: 20px;
            background-color: #00ff00;
            width: 0%;
            transition: width 0.5s ease-in-out;
            text-align: center;
            line-height: 20px;
            color: #fff;
        }

        #result-content {
            font-size: 1.2em;
            margin: 20px;
        }

        #dashboard-content {
            width: 100%;
            height: 100%;
            overflow-y: auto;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
        }

        #dashboard-content table {
            width: 100%;
            border-collapse: collapse;
        }
        
        #dashboard-content th, #dashboard-content td {
            border: 1px solid #fff;
            padding: 10px;
            text-align: left;
        }

        .fade-out {
            opacity: 0;
            transition: opacity 1s;
        }
        .fade-in {
            opacity: 1;
            transition: opacity 1s;
        }

        .emoji {
            font-size: 2em;
        }
        
        .star-burst {
            animation: sparkle 0.8s ease-out forwards;
        }
        
        @keyframes sparkle {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 0.5; }
        }

    </style>
</head>
<body>
    <video id="bg-video" autoplay muted loop>
        <source src="https://assets.mixkit.co/videos/preview/mixkit-floating-lights-in-an-ocean-4067-large.mp4" type="video/mp4">
    </video>

    <div id="game-container">
        <div id="start-screen" class="visible">
            <h1>잃어버린 지혜를 찾아서</h1>
            <p>고대 아틀란티스 대륙에서 당신의 숨겨진 잠재력을 발견하세요!</p>
            <button class="button" id="start-btn">모험 시작하기</button>
        </div>

        <div id="character-select-screen">
            <h2>캐릭터 선택</h2>
            <p>당신의 모험을 함께할 캐릭터를 선택하세요. 캐릭터마다 다른 모험이 펼쳐집니다!</p>
            <div id="character-list">
                <div class="character-card" data-character="scholar">
                    <img src="https://via.placeholder.com/100/ffcc00/000000?text=학자" alt="고대 학자">
                    <h3>고대 학자</h3>
                    <p>지혜의 문헌을 해독하며 지식의 길을 여는 탐험가</p>
                </div>
                <div class="character-card" data-character="shaman">
                    <img src="https://via.placeholder.com/100/2ecc71/000000?text=정령술사" alt="정령술사">
                    <h3>정령술사</h3>
                    <p>자연의 힘과 교감하며 숨겨진 비밀을 밝히는 자</p>
                </div>
                <div class="character-card" data-character="warrior">
                    <img src="https://via.placeholder.com/100/e74c3c/000000?text=싸움꾼" alt="싸움꾼">
                    <h3>싸움꾼</h3>
                    <p>강인한 신체와 용기로 어떤 난관도 헤쳐나가는 전사</p>
                </div>
                <div class="character-card" data-character="artist">
                    <img src="https://via.placeholder.com/100/9b59b6/000000?text=예술가" alt="예술가">
                    <h3>예술가</h3>
                    <p>아름다운 음악과 그림으로 세상을 물들이는 창조자</p>
                </div>
            </div>
            <button class="button" id="select-char-btn" disabled>선택 완료</button>
        </div>

        <div id="quest-screen">
            <h2 id="quest-title"></h2>
            <p id="quest-story"></p>
            <div id="quest-text"></div>
            <div id="quest-options"></div>
            <div id="progress-bar-container">
                <div id="progress-bar">0%</div>
            </div>
        </div>

        <div id="result-screen">
            <h2>모험 완료!</h2>
            <p>축하합니다! 당신의 모험이 끝났습니다. 당신의 강점 지능은 바로...</p>
            <div id="result-content"></div>
            <button class="button" id="restart-btn">다시 시작하기</button>
            <button class="button" id="dashboard-btn">교사 대시보드 보기</button>
        </div>

        <div id="dashboard-screen">
            <h2>교사 대시보드</h2>
            <div id="dashboard-content">
                <p>로딩 중...</p>
            </div>
            <button class="button" id="back-to-home-btn">처음으로</button>
        </div>
    </div>

    <audio id="bgm" loop>
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-ancient-forest-soundscape-2067.mp3" type="audio/mpeg">
    </audio>

    <script>
        const gameContainer = document.getElementById('game-container');
        const startScreen = document.getElementById('start-screen');
        const characterSelectScreen = document.getElementById('character-select-screen');
        const questScreen = document.getElementById('quest-screen');
        const resultScreen = document.getElementById('result-screen');
        const dashboardScreen = document.getElementById('dashboard-screen');
        const startBtn = document.getElementById('start-btn');
        const characterCards = document.querySelectorAll('.character-card');
        const selectCharBtn = document.getElementById('select-char-btn');
        const questTitle = document.getElementById('quest-title');
        const questStory = document.getElementById('quest-story');
        const questText = document.getElementById('quest-text');
        const questOptions = document.getElementById('quest-options');
        const progressBar = document.getElementById('progress-bar');
        const resultContent = document.getElementById('result-content');
        const restartBtn = document.getElementById('restart-btn');
        const dashboardBtn = document.getElementById('dashboard-btn');
        const backToHomeBtn = document.getElementById('back-to-home-btn');
        const bgm = document.getElementById('bgm');

        let currentScreen = 'start';
        let selectedCharacter = null;
        let questIndex = 0;
        let scores = { '언어지능': 0, '논리수학지능': 0, '공간지능': 0, '신체운동지능': 0, '음악지능': 0, '대인관계지능': 0, '개인내적지능': 0, '자연주의지능': 0 };
        const totalQuests = 20;
        let studentResults = [];

        // 퀘스트 선택지를 4개로 늘리고, 모든 지능을 측정하도록 수정
        const allQuests = [
            {
                title: '고대 문명 기록물 해독',
                text: '수천 년 동안 잠들어 있던 고대 문명 기록물이 나타났습니다. 이 기록물을 해독해야 다음 유적으로 가는 길이 열립니다.',
                options: [
                    { text: '기록물의 문장 구조를 분석하여 의미를 파악한다.', intelligence: '언어지능' },
                    { text: '기록물에 새겨진 기하학적 무늬를 분석하여 다음 유적의 좌표를 계산한다.', intelligence: '논리수학지능' },
                    { text: '기록물에 묘사된 미로의 지도를 머릿속으로 그려 탈출 경로를 찾는다.', intelligence: '공간지능' },
                    { text: '기록물의 촉감을 느끼고 고대인의 체취를 상상하여 그들의 의도를 파악한다.', intelligence: '신체운동지능' },
                ]
            },
            {
                title: '깊은 바닷속 보물 찾기',
                text: '전설의 보물이 깊은 바닷속에 잠들어 있습니다. 숨겨진 보물을 찾아 심해의 압력과 어둠을 이겨내야 합니다.',
                options: [
                    { text: '바닷속에서 들려오는 신비로운 소리를 따라 보물의 위치를 추적한다.', intelligence: '음악지능' },
                    { text: '바다 생물들과 교감하여 보물에 대한 힌트를 얻는다.', intelligence: '대인관계지능' },
                    { text: '자신의 공포심을 극복하고, 심해의 압력을 견디며 보물이 있는 곳으로 나아간다.', intelligence: '개인내적지능' },
                    { text: '심해의 해류와 생태계를 분석하여 가장 안전한 경로를 선택한다.', intelligence: '자연주의지능' },
                ]
            },
            {
                title: '무너진 신전의 퍼즐',
                text: '아틀란티스의 신전이 무너져 내렸습니다. 신전의 퍼즐을 풀어 무사히 탈출해야 합니다.',
                options: [
                    { text: '무너진 돌 조각들의 무게와 부피를 계산하여 퍼즐의 답을 찾는다.', intelligence: '논리수학지능' },
                    { text: '돌 조각들이 원래 있던 위치를 상상하여 정확하게 복원한다.', intelligence: '공간지능' },
                    { text: '자신의 몸을 유연하게 움직여 돌 조각 사이를 빠져나간다.', intelligence: '신체운동지능' },
                    { text: '벽에 새겨진 고대 시를 낭송하며 퍼즐의 해법을 찾는다.', intelligence: '언어지능' },
                ]
            },
            {
                title: '어둠 속의 환영',
                text: '마법이 걸린 어둠 속에서 환영이 나타났습니다. 환영의 유혹을 뿌리치고 진실을 찾아야 합니다.',
                options: [
                    { text: '마음속의 목소리에 집중하며 진정한 길을 깨닫는다.', intelligence: '개인내적지능' },
                    { text: '환영의 움직임에 맞춰 춤을 추며 환술을 무력화한다.', intelligence: '신체운동지능' },
                    { text: '환영이 내는 소리의 음정 변화를 분석하여 다음 길을 예측한다.', intelligence: '음악지능' },
                    { text: '환영과 대화하며 그들의 약점을 파악한다.', intelligence: '대인관계지능' },
                ]
            },
            {
                title: '자연의 신비한 균열',
                text: '갑자기 거대한 균열이 나타나 자연의 질서를 파괴하고 있습니다. 균열을 막아야 합니다.',
                options: [
                    { text: '균열의 형태와 크기를 분석하여 틈새로 들어갈 길을 찾는다.', intelligence: '공간지능' },
                    { text: '균열에서 흘러나오는 에너지의 파동을 느끼고, 이를 조화롭게 바꾼다.', intelligence: '자연주의지능' },
                    { text: '균열에 대해 연구한 고대 문헌의 정보를 떠올린다.', intelligence: '언어지능' },
                    { text: '균열을 통과하기 위해 몸의 균형을 완벽하게 유지한다.', intelligence: '신체운동지능' },
                ]
            },
            {
                title: '정령들의 음악회',
                text: '길을 잃은 당신 앞에 신비로운 정령들이 나타났습니다. 그들이 내는 멜로디에 맞춰 협주해야 합니다.',
                options: [
                    { text: '정령들이 내는 소리의 화음과 리듬을 완벽하게 재현한다.', intelligence: '음악지능' },
                    { text: '정령들과 대화하며 각자가 원하는 바를 이해한다.', intelligence: '대인관계지능' },
                    { text: '정령들의 움직임과 자연 현상을 연관 지어 생각한다.', intelligence: '자연주의지능' },
                    { text: '정령의 움직임 패턴을 분석하여 다음 멜로디를 예측한다.', intelligence: '논리수학지능' },
                ]
            },
            {
                title: '용사의 시험',
                text: '전설적인 용사의 무덤에 도착했습니다. 용사의 시험을 통과해야 보물을 얻을 수 있습니다.',
                options: [
                    { text: '시험의 규칙을 파악하고 논리적으로 순서를 배열한다.', intelligence: '논리수학지능' },
                    { text: '무덤의 구조를 머릿속으로 시뮬레이션하여 함정을 피한다.', intelligence: '공간지능' },
                    { text: '무덤에 새겨진 용사의 전기를 읽고 그들의 의지를 이해한다.', intelligence: '언어지능' },
                    { text: '내면의 용기를 끌어내어 두려움 없이 시험에 임한다.', intelligence: '개인내적지능' },
                ]
            },
            {
                title: '신비한 생명체와의 조우',
                text: '미지의 생명체와 마주쳤습니다. 이들을 진정시키고 길을 가야 합니다.',
                options: [
                    { text: '생명체와 직접 소통을 시도하여 마음을 얻는다.', intelligence: '대인관계지능' },
                    { text: '생명체의 울음소리에서 음계를 찾아 평화로운 멜로디를 연주한다.', intelligence: '음악지능' },
                    { text: '생명체의 행동 패턴을 관찰하여 다음 행동을 예측한다.', intelligence: '자연주의지능' },
                    { text: '침착하게 자신의 감정을 다스리며 위기에 대처한다.', intelligence: '개인내적지능' },
                ]
            },
            {
                title: '천공의 도시 지도',
                text: '하늘에 떠 있는 천공의 도시로 가야 합니다. 정확한 지도를 그려내야 합니다.',
                options: [
                    { text: '지도를 구성하는 도형의 규칙성을 찾아낸다.', intelligence: '논리수학지능' },
                    { text: '천공 도시의 풍경을 머릿속에 담고, 이를 정확한 지도로 구현한다.', intelligence: '공간지능' },
                    { text: '지도를 그리는 데 필요한 도구의 쓰임새를 파악하여 활용한다.', intelligence: '신체운동지능' },
                    { text: '고대 기록에 남아있는 도시의 이름을 떠올려 지도에 새긴다.', intelligence: '언어지능' },
                ]
            },
            {
                title: '고대 장인의 작품',
                text: '고대 장인이 만든 신비로운 기계가 작동을 멈췄습니다. 기계를 수리해야 합니다.',
                options: [
                    { text: '기계의 움직임을 몸으로 따라하며 작동 원리를 파악한다.', intelligence: '신체운동지능' },
                    { text: '기계에 새겨진 글을 읽고 해설하며 작동 순서를 알아낸다.', intelligence: '언어지능' },
                    { text: '기계의 복잡한 부품 구조를 이해하여 올바른 위치에 끼워 넣는다.', intelligence: '공간지능' },
                    { text: '기계의 논리적 오류를 찾아내고 수정한다.', intelligence: '논리수학지능' },
                ]
            },
            {
                title: '바다의 여왕을 위한 노래',
                text: '바다의 여왕을 위한 노래를 완성해야 합니다. 잃어버린 악보를 찾아내세요.',
                options: [
                    { text: '흩어져 있는 악보 조각들을 맞춰 노래를 완성한다.', intelligence: '음악지능' },
                    { text: '여왕의 감정을 이해하여 그녀의 슬픔을 달래는 멜로디를 만든다.', intelligence: '개인내적지능' },
                    { text: '바닷속 친구들에게 도움을 요청하여 악보를 찾는다.', intelligence: '대인관계지능' },
                    { text: '주변의 산호초와 조개 껍데기를 이용해 노래를 재구성한다.', intelligence: '자연주의지능' },
                ]
            },
            {
                title: '마음의 미로',
                text: '환영술사가 만든 마음의 미로에 갇혔습니다. 이 미로를 빠져나오려면 자신의 내면을 들여다봐야 합니다.',
                options: [
                    { text: '미로의 구조를 머릿속으로 시각화하여 출구를 찾는다.', intelligence: '공간지능' },
                    { text: '마음속 깊은 곳에 있는 본연의 자신을 믿고 앞으로 나아간다.', intelligence: '개인내적지능' },
                    { text: '환영술사와 논리적인 대화를 나누어 미로의 규칙을 파악한다.', intelligence: '논리수학지능' },
                    { text: '주변에 있는 식물들을 관찰하며 자연의 흐름을 따라 길을 찾는다.', intelligence: '자연주의지능' },
                ]
            },
            {
                title: '사나운 괴물 길들이기',
                text: '고대 유적을 지키는 사나운 괴물이 길을 막고 있습니다. 괴물을 길들여 길을 통과해야 합니다.',
                options: [
                    { text: '괴물의 울음소리가 내는 리듬에 맞춰 춤을 춘다.', intelligence: '음악지능' },
                    { text: '괴물의 표정과 감정을 읽고 진심으로 다가간다.', intelligence: '대인관계지능' },
                    { text: '괴물의 위협적인 몸짓에 위축되지 않고 용감하게 맞선다.', intelligence: '개인내적지능' },
                    { text: '괴물이 서식하는 환경과 먹이를 분석하여 괴물의 습성을 파악한다.', intelligence: '자연주의지능' },
                ]
            },
            {
                title: '사막의 모래시계',
                text: '사막 한가운데서 고대 모래시계가 작동을 멈췄습니다. 모래시계를 다시 작동시켜야 합니다.',
                options: [
                    { text: '모래시계에 대한 고대 문헌을 찾아 작동 방법을 알아낸다.', intelligence: '언어지능' },
                    { text: '멈춘 모래시계의 작동 원리를 계산하여 오류를 해결한다.', intelligence: '논리수학지능' },
                    { text: '모래시계의 복잡한 내부 구조를 눈으로 파악하여 문제를 해결한다.', intelligence: '공간지능' },
                    { text: '모래시계의 부품을 조심스럽게 다루어 고장 난 부분을 수리한다.', intelligence: '신체운동지능' },
                ]
            },
            {
                title: '고대 시장의 수수께끼',
                text: '활기 넘치는 고대 시장에 도착했습니다. 시장에 숨겨진 수수께끼를 풀어 다음 길을 찾아야 합니다.',
                options: [
                    { text: '사람들과 활발하게 대화하며 수수께끼에 대한 힌트를 얻는다.', intelligence: '대인관계지능' },
                    { text: '시장 상인들이 흥정하는 목소리의 억양과 톤을 분석하여 정보를 얻는다.', intelligence: '음악지능' },
                    { text: '시장의 혼잡한 길을 몸으로 느끼며 빠르게 나아간다.', intelligence: '신체운동지능' },
                    { text: '시장에서 팔리는 식물의 종류를 분석하여 자연적인 힌트를 찾는다.', intelligence: '자연주의지능' },
                ]
            },
            {
                title: '위험한 함정의 숲',
                text: '고대 함정으로 가득한 숲에 들어섰습니다. 몸으로 함정을 감지하고 피해야 합니다.',
                options: [
                    { text: '자신의 직감을 믿고 본능적으로 함정을 피한다.', intelligence: '개인내적지능' },
                    { text: '숲에 사는 동물들의 움직임을 관찰하여 안전한 길을 파악한다.', intelligence: '자연주의지능' },
                    { text: '자신의 몸을 민첩하게 움직여 함정을 뛰어넘는다.', intelligence: '신체운동지능' },
                    { text: '숲에 숨겨진 함정의 규칙을 찾아내어 논리적으로 피한다.', intelligence: '논리수학지능' },
                ]
            },
            {
                title: '잊힌 언어의 문',
                text: '아틀란티스의 보물을 숨겨놓은 문에 도착했습니다. 이 문을 열려면 잊힌 언어의 문장을 완성해야 합니다.',
                options: [
                    { text: '문장에 숨겨진 운율을 파악하여 올바른 단어를 추론한다.', intelligence: '음악지능' },
                    { text: '문장의 의미를 분석하여 다음 문장을 논리적으로 구성한다.', intelligence: '언어지능' },
                    { text: '문장의 형태와 모양을 재배열하여 해법을 찾는다.', intelligence: '공간지능' },
                    { text: '문장을 완벽하게 외워 빈칸에 채워 넣는다.', intelligence: '개인내적지능' },
                ]
            },
            {
                title: '영혼의 거울',
                text: '당신의 내면을 비추는 영혼의 거울 앞에 섰습니다. 거울에 나타난 자신의 모습을 마주해야 합니다.',
                options: [
                    { text: '거울 속 자신에게 말을 걸며 진심으로 소통한다.', intelligence: '대인관계지능' },
                    { text: '거울 속 자신과 몸짓으로 교감하며 진실을 깨닫는다.', intelligence: '신체운동지능' },
                    { text: '거울 속 자신의 감정을 깊이 들여다보고 이해한다.', intelligence: '개인내적지능' },
                    { text: '거울에 비친 자신의 모습이 내는 미세한 소리를 듣고 분석한다.', intelligence: '음악지능' },
                ]
            },
            {
                title: '고대 자연의 약초',
                text: '신비한 약초로 치료약을 만들어야 합니다. 약초를 찾고 조합해야 합니다.',
                options: [
                    { text: '약초의 생김새와 지형을 보며 약초의 위치를 추론한다.', intelligence: '자연주의지능' },
                    { text: '약초에 대한 고대 문서의 내용을 정확하게 기억하여 활용한다.', intelligence: '언어지능' },
                    { text: '약초를 조합하는 과정에서 정확한 무게와 비율을 계산한다.', intelligence: '논리수학지능' },
                    { text: '약초를 조심스럽게 다루고 손으로 직접 조합한다.', intelligence: '신체운동지능' },
                ]
            },
            {
                title: '유적을 지키는 수호자',
                text: '최종 보물이 있는 곳에 도착했습니다. 보물을 지키는 수호자와 소통해야 합니다.',
                options: [
                    { text: '수호자의 언어를 배워 그의 마음을 이해한다.', intelligence: '언어지능' },
                    { text: '수호자의 복잡한 외형을 파악해 약점을 찾는다.', intelligence: '공간지능' },
                    { text: '수호자의 감정을 읽고 가장 효과적인 대화를 시도한다.', intelligence: '대인관계지능' },
                    { text: '수호자의 움직임에 대한 수학적 확률을 계산해 약점을 파고든다.', intelligence: '논리수학지능' },
                ]
            }
        ];
        
        const characterData = {
            scholar: { name: '고대 학자' },
            shaman: { name: '정령술사' },
            warrior: { name: '싸움꾼' },
            artist: { name: '예술가' }
        };

        const intelligenceInfo = {
            '언어지능': { title: '언어지능', desc: '말과 글을 통해 자신의 생각을 표현하고 이해하는 능력', emoji: '✍️' },
            '논리수학지능': { title: '논리수학지능', desc: '논리적인 문제 해결, 패턴 인식, 추리 능력', emoji: '🤔' },
            '공간지능': { title: '공간지능', desc: '공간, 형태, 이미지를 시각적으로 파악하고 다루는 능력', emoji: '🗺️' },
            '신체운동지능': { title: '신체운동지능', desc: '신체를 자유자재로 다루고 표현하는 능력', emoji: '🏃' },
            '음악지능': { title: '음악지능', desc: '음악적 패턴을 인식하고 창조하는 능력', emoji: '🎵' },
            '대인관계지능': { title: '대인관계지능', desc: '타인의 감정, 의도를 이해하고 소통하는 능력', emoji: '👥' },
            '개인내적지능': { title: '개인내적지능', desc: '자신의 감정, 목표, 강점을 이해하는 능력', emoji: '🧘' },
            '자연주의지능': { title: '자연주의지능', desc: '자연 환경의 특징을 인식하고 분류하는 능력', emoji: '🌳' }
        };

        const playBGM = () => {
            bgm.volume = 0.5;
            bgm.play();
        };

        const stopBGM = () => {
            bgm.pause();
            bgm.currentTime = 0;
        };

        const switchScreen = (from, to) => {
            document.getElementById(from).classList.remove('visible');
            setTimeout(() => {
                document.getElementById(to).classList.add('visible');
            }, 500);
        };

        const startGame = () => {
            switchScreen('start-screen', 'character-select-screen');
            playBGM();
        };

        const selectCharacter = (e) => {
            const card = e.currentTarget;
            characterCards.forEach(c => c.classList.remove('selected'));
            card.classList.add('selected');
            selectedCharacter = card.dataset.character;
            selectCharBtn.disabled = false;
        };

        const startQuest = () => {
            if (!selectedCharacter) return;
            switchScreen('character-select-screen', 'quest-screen');
            questIndex = 0;
            updateQuest();
        };

        const updateQuest = () => {
            if (questIndex >= totalQuests) {
                endGame();
                return;
            }

            const currentQuest = allQuests[questIndex];
            questTitle.textContent = `퀘스트 ${questIndex + 1}/${totalQuests}`;
            questStory.textContent = characterData[selectedCharacter].story || '깊은 바닷속 고대 유적지, 당신의 모험이 시작됩니다.';
            questText.textContent = currentQuest.text;
            questOptions.innerHTML = '';

            currentQuest.options.forEach((option) => {
                const button = document.createElement('button');
                button.textContent = option.text;
                button.classList.add('quest-option');
                button.addEventListener('click', () => handleAnswer(option.intelligence));
                questOptions.appendChild(button);
            });

            const progress = (questIndex / totalQuests) * 100;
            progressBar.style.width = `${progress}%`;
            progressBar.textContent = `${Math.round(progress)}%`;
        };
        
        const handleAnswer = (intelligenceType) => {
            const options = questOptions.querySelectorAll('.quest-option');
            options.forEach(btn => btn.disabled = true);
            
            scores[intelligenceType]++;

            // 선택지 애니메이션 효과
            const selectedButton = Array.from(options).find(btn => btn.textContent.includes(intelligenceInfo[intelligenceType].title));
            if(selectedButton) {
                selectedButton.style.border = '2px solid #00ff00';
                selectedButton.style.transform = 'scale(1.05)';
                selectedButton.innerHTML += ' ✨';
            }

            questIndex++;
            setTimeout(updateQuest, 1000);
        };

        const endGame = () => {
            const resultList = Object.entries(scores).sort((a, b) => b[1] - a[1]);
            const dominantIntelligence = resultList[0][0];
            const dominantScore = resultList[0][1];
            
            resultContent.innerHTML = `
                <p>당신의 강점 지능은 바로 <span style="font-size:1.5em; font-weight:bold; color:#ffcc00;">${intelligenceInfo[dominantIntelligence].title}</span>입니다! 🎉</p>
                <p>${intelligenceInfo[dominantIntelligence].emoji}</p>
                <p>${intelligenceInfo[dominantIntelligence].desc}</p>
                <p>모험을 통해 ${dominantIntelligence}을(를) ${dominantScore}번 발휘했습니다!</p>
            `;
            
            // 대시보드 데이터 저장
            const studentName = prompt("이름을 입력하세요:") || "익명";
            studentResults.push({ name: studentName, character: selectedCharacter, scores: { ...scores } });

            // 스코어 리셋
            scores = { '언어지능': 0, '논리수학지능': 0, '공간지능': 0, '신체운동지능': 0, '음악지능': 0, '대인관계지능': 0, '개인내적지능': 0, '자연주의지능': 0 };

            switchScreen('quest-screen', 'result-screen');
        };

        const showDashboard = () => {
            switchScreen('result-screen', 'dashboard-screen');
            const dashboardContent = document.getElementById('dashboard-content');
            
            if (studentResults.length === 0) {
                dashboardContent.innerHTML = '<p>아직 참여한 학생이 없습니다.</p>';
                return;
            }

            let tableHTML = '<table><thead><tr><th>이름</th><th>캐릭터</th><th>강점 지능</th></tr></thead><tbody>';
            studentResults.forEach(student => {
                const sortedScores = Object.entries(student.scores).sort((a, b) => b[1] - a[1]);
                const dominant = sortedScores[0][0];
                tableHTML += `<tr><td>${student.name}</td><td>${characterData[student.character].name}</td><td>${intelligenceInfo[dominant].title}</td></tr>`;
            });
            tableHTML += '</tbody></table>';
            dashboardContent.innerHTML = tableHTML;
        };

        const restartGame = () => {
            switchScreen('result-screen', 'start-screen');
        };

        const goBackToHome = () => {
            switchScreen('dashboard-screen', 'start-screen');
        };

        startBtn.addEventListener('click', startGame);
        characterCards.forEach(card => card.addEventListener('click', selectCharacter));
        selectCharBtn.addEventListener('click', startQuest);
        restartBtn.addEventListener('click', restartGame);
        dashboardBtn.addEventListener('click', showDashboard);
        backToHomeBtn.addEventListener('click', goBackToHome);
    </script>
</body>
</html>
