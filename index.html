<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>📜 다중지능 탐험: 고대의 부름</title>
<link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=Cinzel:wght@700&display=swap" rel="stylesheet">
<style>
/* 변수 및 기본 스타일 */
:root {
    --brown-text: #4a3a2a;
    --gold: #c89a4b;
    --card-bg: rgba(255, 255, 255, 0.85);
}

* {
    box-sizing: border-box;
}

body {
    margin: 0;
    font-family: 'Gowun Dodum', serif;
    background-color: #5d4037; /* 이미지 로딩 전 배경색 */
    background-image: url('https://firebasestorage.googleapis.com/v0/b/gtemp-a8599.appspot.com/o/papyrus-1478204_1280.jpg?alt=media&token=26214300-84c4-42ea-a4b5-65476d0d216a');
    background-repeat: no-repeat;
    background-position: center center;
    background-size: cover;
    background-attachment: fixed;
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 20px;
    position: relative;
    overflow: hidden;
    transition: background-image 1s ease-in-out;
}

body::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.4);
    pointer-events: none;
    transition: background-color 2s ease-in-out;
}

.wrap {
    width: 100%;
    max-width: 1200px;
}

.header {
    text-align: center;
    margin-bottom: 20px;
    animation: fadeInDown 1s ease-out;
}

.title {
    font-family: 'Cinzel', serif;
    font-size: clamp(2rem, 5vw, 3.5rem);
    color: var(--gold);
    text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.8);
}

.subtitle {
    font-family: 'Gowun Dodum';
    opacity: 0.9;
    font-size: clamp(1rem, 2vw, 1.3rem);
    color: #f0f0f0;
}

/* 레이아웃 */
.layout {
    display: flex;
    gap: 20px;
}

.left, .right {
    transition: all 0.5s ease-out;
}

.left {
    width: 360px;
    animation: fadeInLeft 1s ease-out;
}

.right {
    flex: 1;
    animation: fadeInRight 1s ease-out;
}

/* 카드 UI */
.card {
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(8px);
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
    border: 1px solid rgba(255, 215, 102, 0.15);
}

/* 캐릭터 선택 */
.char-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
}

.char {
    padding: 10px;
    border-radius: 10px;
    background: rgba(0, 0, 0, 0.3);
    text-align: center;
    cursor: pointer;
    border: 1px solid transparent;
    transition: all 0.3s ease;
}

.char:hover {
    transform: translateY(-5px);
    background: rgba(0, 0, 0, 0.5);
    border-color: var(--gold);
}

.char.selected {
    background: rgba(200, 154, 75, 0.3);
    border-color: var(--gold);
    transform: translateY(-5px);
}

/* 폼 요소 */
label {
    display: block;
    color: var(--gold);
    font-weight: 700;
    margin-bottom: 6px;
}

input[type=text] {
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid rgba(255, 215, 102, 0.2);
    background: rgba(0, 0, 0, 0.3);
    color: #fff;
    margin-bottom: 10px;
    font-family: 'Gowun Dodum', serif;
}

.btn {
    display: inline-flex;
    gap: 8px;
    align-items: center;
    justify-content: center;
    padding: 12px 16px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    background: linear-gradient(145deg, #b38645, #835e2c);
    color: #fff;
    font-weight: bold;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
    width: 100%;
    font-family: 'Gowun Dodum', serif;
    font-size: 1rem;
    transition: all 0.3s ease;
}

.btn:disabled {
    background: #555;
    cursor: not-allowed;
    box-shadow: none;
}

.btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
}

/* 게임 및 퀘스트 영역 */
#game-card {
    background: url('https://firebasestorage.googleapis.com/v0/b/gtemp-a8599.appspot.com/o/ancient_scroll.png?alt=media&token=f0310243-7f3e-4b72-b7e6-23f2113222e4') no-repeat center center;
    background-size: 100% 100%;
    color: var(--brown-text);
    padding: 50px 60px;
    min-height: 550px;
    position: relative;
    box-shadow: 0 10px 30px rgba(0,0,0,0.6);
}

.quest-header {
    text-align: center;
    margin-bottom: 20px;
}

.quest-header h3 {
    font-family: 'Cinzel', serif;
    color: #6a4a2a;
    margin: 0;
    font-size: clamp(1.2rem, 2.5vw, 1.5rem);
}

.quest-text {
    font-size: clamp(1rem, 2.2vw, 1.3rem);
    line-height: 2;
    min-height: 100px;
}

.options {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
    margin-top: 20px;
}

.option {
    padding: 12px;
    border-radius: 10px;
    background: rgba(189, 168, 133, 0.3);
    cursor: pointer;
    border: 1px solid rgba(112, 83, 48, 0.3);
    transition: all 0.2s ease;
    text-align: center;
    font-size: clamp(0.9rem, 2vw, 1.1rem);
    word-break: keep-all;
    user-select: none;
}

.option:hover {
    transform: scale(1.03);
    background: rgba(189, 168, 133, 0.5);
    border-color: var(--brown-text);
}

.option .label {
    font-weight: bold;
}

/* 능력치 통계 */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
    margin-top: 12px;
    color: #fff;
}

.stat {
    background: rgba(0, 0, 0, 0.3);
    padding: 8px;
    border-radius: 8px;
    text-align: center;
}

.bar {
    height: 10px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 6px;
    margin-top: 8px;
    overflow: hidden;
}

.bar-inner {
    height: 100%;
    background: linear-gradient(90deg, var(--gold), #e6b873);
    width: 0%;
    transition: width 0.6s ease-in-out;
}

/* 결과 영역 */
.result-content {
    color: var(--brown-text);
    text-align: center;
}

.result-content h3 {
    font-family: 'Cinzel', serif;
    color: #6a4a2a;
}

/* 애니메이션 */
@keyframes fadeInDown {
    from { opacity: 0; transform: translateY(-30px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes fadeInLeft {
    from { opacity: 0; transform: translateX(-50px); }
    to { opacity: 1; transform: translateX(0); }
}

@keyframes fadeInRight {
    from { opacity: 0; transform: translateX(50px); }
    to { opacity: 1; transform: translateX(0); }
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.spinner {
    display: none;
    border: 4px solid rgba(255, 255, 255, 0.3);
    border-top: 4px solid var(--gold);
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: spin 1s linear infinite;
    margin: 0 auto;
}

/* 반응형 디자인 */
@media(max-width:900px) {
    .layout {
        flex-direction: column;
    }

    .left {
        width: 100%;
    }

    #game-card {
        padding: 30px;
    }
}
</style>
</head>
<body>

<!-- 오디오 파일은 Mixkit에서 가져왔습니다 -->
<audio id="bgm" src="https://assets.mixkit.co/sfx/preview/mixkit-calm-music-2200.mp3" loop></audio>
<audio id="sfx-turn" src="https://assets.mixkit.co/sfx/preview/mixkit-game-click-1110.mp3"></audio>

<div class="wrap">
  <div class="header">
    <div class="title">Ancient Calling</div>
    <div class="subtitle">나의 다중지능을 찾아 떠나는 모험</div>
  </div>

  <div class="layout">
    <div class="left">
      <div class="card">
        <label>모험가 이름</label>
        <input id="input-name" type="text" placeholder="예: 김민준" />
        <label>소속 (반)</label>
        <input id="input-class" type="text" placeholder="예: 1학년 3반" />
        <label>여정을 함께할 동료</label>
        <div id="char-row" class="char-row">
          <div class="char" data-id="prince"><div class="emoji">🤴</div><div class="name">용감한 왕자</div></div>
          <div class="char" data-id="princess"><div class="emoji">👸</div><div class="name">지혜로운 공주</div></div>
          <div class="char" data-id="warrior"><div class="emoji">⚔️</div><div class="name">강인한 전사</div></div>
          <div class="char" data-id="wizard"><div class="emoji">🔮</div><div class="name">신비한 마법사</div></div>
        </div>
        <div style="margin-top:20px;">
          <button id="btn-start" class="btn" disabled>
            <span id="start-btn-text">▶ 모험 시작하기</span>
            <div id="start-btn-spinner" class="spinner"></div>
          </button>
        </div>
      </div>

      <div id="stats-panel" class="card" style="margin-top:12px; display:none;">
          <div id="stats" class="stats-grid"></div>
      </div>
    </div>

    <div class="right">
      <div id="game-card" class="card">
        <div id="pre-game">
          <div style="text-align:center; padding-top: 80px;">
            <h3 style="font-family:'Cinzel', serif; color: var(--brown-text);">📜 모험의 서막</h3>
            <p style="font-size: 1.1rem; line-height: 1.8;">이름과 소속을 적고, 여정을 함께할 동료를 선택하세요.<br>당신의 선택이 모여 미래의 길을 밝혀줄 것입니다.<br>이제, 고대의 부름에 응답할 시간입니다.</p>
          </div>
        </div>

        <div id="game-area" style="display:none">
          <div class="quest-header">
            <h3 id="quest-title"></h3>
          </div>
          <div id="quest-text" class="quest-text"></div>
          <div id="options" class="options"></div>
        </div>
        
        <div id="result-area" style="display:none; padding-top: 50px;">
          <div class="result-content" id="result-content"></div>
          <button id="btn-restart" class="btn" style="max-width:300px; margin: 20px auto 0;">🔄 새로운 모험 시작하기</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// 전역 변수 및 상수 설정
const sounds = {
    bgm: document.getElementById('bgm'),
    turn: document.getElementById('sfx-turn'),
};
sounds.bgm.volume = 0.2; // BGM 볼륨 조절

// HTML 요소 선택을 위한 헬퍼 함수
const el = id => document.getElementById(id);

// 게임 데이터: 기본 점수 및 플레이어 상태
const baseScores = {linguistic:50,logical:50,spatial:50,bodily:50,musical:50,interpersonal:50,intrapersonal:50,naturalist:50};
let scores = {};
let player = {name:'',clazz:'',charId:'',questIndex:0};

/* ====== 퀘스트 데이터 (서사 강화 버전) ====== */
function q(title, text, a, b, c, d){ return { title, text, options:[a,b,c,d] }; }
function opt(text, effects){ return {t:text, e:effects}; }

const quests = {
  prince: [
    q("왕의 서신", "먼지 쌓인 서고에서 아버지의 흔적이 담긴 낡은 편지를 발견했다. '진정한 왕의 자격은 왕관이 아닌, 백성을 비추는 빛에 있나니. 그 빛을 따라가거라.' 이 수수께끼 같은 유언의 실마리는 어디서부터 찾아야 할까?",
      opt('📜 편지에 쓰인 단어들의 상징적 의미를 파고들어 분석한다.',{linguistic:14}),
      opt('🗺️ 편지에 남은 희미한 지도의 흔적을 따라 직접 현장으로 향한다.',{bodily:12,spatial:6}),
      opt('👥 편지를 마지막으로 만졌을 법한 왕궁의 오랜 신하를 찾아가 대화한다.',{interpersonal:12,logical:6}),
      opt('🌿 편지지에서 희미하게 나는 풀 향기를 단서로, 특정 지역의 식생을 조사한다.',{naturalist:8,spatial:6})
    ),
    q("불안한 소문", "백성들 사이에 퍼지는 불안한 소문이 왕국의 평화를 위협하고 있다. 소문의 근원을 파악하고 해결해야 한다. 어떻게 할 것인가?",
      opt('🗣️ 사람들의 이야기를 경청하며 소문의 시작점을 파악한다.', {interpersonal:14, intrapersonal: 6}),
      opt('🔢 소문의 확산 속도와 패턴을 분석하여 논리적으로 대응한다.', {logical:12, linguistic: 6}),
      opt('👣 소문의 발원지로 알려진 장소를 직접 찾아가 현장을 조사한다.', {bodily:10, spatial: 8}),
      opt('🎶 소문을 잠재울 평화의 노래를 작곡하여 백성들에게 들려준다.', {musical:14})
    ),
    q("고대 유물", "수수께끼의 힘을 가진 고대 유물이 숨겨진 동굴을 발견했다. 유물을 얻으려면 복잡한 수수께끼를 풀어야 한다. 어떤 방법으로 접근할 것인가?",
      opt('📖 유물에 새겨진 고대 언어를 번역하여 해법을 찾는다.', {linguistic:12, logical: 8}),
      opt('🧩 유물의 복잡한 기계 장치와 패턴을 분석하여 작동 원리를 파악한다.', {logical:14, spatial: 8}),
      opt('✊ 동굴의 지형을 탐색하고 신체적인 능력을 활용해 유물을 확보한다.', {bodily:12, spatial: 6}),
      opt('🧘‍♀️ 유물의 진동과 기운을 느끼며 마음의 눈으로 봉인을 해제한다.', {intrapersonal:14})
    ),
    q("어둠의 그림자", "왕국을 덮친 어둠의 그림자가 숲을 병들게 하고 있다. 숲의 생명력을 되찾아줘야 한다. 어떻게 할 것인가?",
      opt('🌳 숲속의 식물과 동물들과 교감하며 병의 원인을 파악한다.', {naturalist:14, interpersonal: 8}),
      opt('🪄 그림자의 마법적 패턴을 분석해 봉인을 풀어낼 주문을 찾는다.', {logical:12, musical: 6}),
      opt('⚔️ 그림자 자체를 물리적인 힘으로 제압하여 숲을 구한다.', {bodily:14}),
      opt('✍️ 숲의 변화를 기록하며 해결책을 찾아낸다.', {linguistic:10, naturalist: 6})
    ),
    q("길 잃은 여행자", "길을 잃고 헤매는 여행자를 만났다. 그는 당신에게 신비한 수수께끼를 건네며 길을 알려달라고 한다. 어떻게 할 것인가?",
      opt('🗣️ 여행자의 말을 경청하고, 그의 심리 상태를 이해하며 조언한다.', {interpersonal:14, linguistic: 6}),
      opt('🧭 여행자의 목적지까지의 지도를 직접 그려주며 길을 안내한다.', {spatial:12, interpersonal: 6}),
      opt('🤔 수수께끼를 논리적으로 분석하여 해답을 찾아낸다.', {logical:12}),
      opt('🤝 함께 길을 떠나며 몸짓과 행동으로 소통한다.', {bodily:10, interpersonal: 8})
    ),
    q("신비한 연못", "오래된 연못가에서 아름다운 멜로디가 들려온다. 멜로디의 정체를 파악하고, 그에 담긴 힘을 깨우려 한다.",
      opt('🎵 멜로디의 리듬과 화음을 분석하여 악보로 옮겨 적는다.', {musical:16, logical: 6}),
      opt('🌊 연못 주변의 자연환경을 조사하여 멜로디의 근원을 찾는다.', {naturalist:12, spatial: 6}),
      opt('🧘‍♀️ 멜로디에 귀 기울이며 내면의 감정을 탐색하고 그 의미를 이해한다.', {intrapersonal:12, musical: 8}),
      opt('🎤 연못의 멜로디에 화답하는 노래를 불러 연못의 힘을 깨운다.', {musical:14, interpersonal: 8})
    )
  ],
  princess: [
    q("비밀의 지도", "어릴 적, 할머니께서 '세상을 밝힐 영원의 빛'이 숨겨진 곳이라며 낡은 지도를 주셨다. 이제 그 의미를 찾아 떠날 시간. 지도의 첫 번째 표식은 '고요의 정원'을 가리키고 있다. 어떻게 그곳을 찾아갈까?",
      opt('📜 지도의 고대 상형문자를 해독하여 정확한 위치를 파악한다.',{linguistic:14}),
      opt('🧭 지도의 지형과 실제 산맥의 흐름을 대조하며 길을 찾는다.',{spatial:14}),
      opt('🗣️ '고요의 정원'에 대한 전설을 아는 마을 현자를 찾아가 조언을 구한다.',{interpersonal:12}),
      opt('🌸 지도에 그려진 특별한 꽃을 찾아, 그 꽃이 피는 곳으로 향한다.',{naturalist:12})
    ),
    q("마음의 거울", "오래된 마법의 거울이 당신의 가장 깊은 불안을 비추고 있다. 이 거울을 통해 내면의 힘을 깨우려면 어떻게 해야 할까?",
      opt('🤔 거울에 비친 불안의 원인을 논리적으로 분석한다.', {logical:12, intrapersonal: 8}),
      opt('✍️ 거울을 보며 떠오르는 감정과 생각을 글로 기록한다.', {linguistic:12, intrapersonal: 8}),
      opt('🧘‍♀️ 조용히 눈을 감고 거울이 보내는 감정의 파동을 느낀다.', {intrapersonal:14}),
      opt('👣 거울에서 한 발짝 떨어져 내 모습과 거리를 두는 연습을 한다.', {bodily:10, intrapersonal: 8})
    ),
    q("궁정의 음모", "궁정 내에서 당신을 해치려는 음모가 꾸며지고 있다. 이 위기를 어떻게 헤쳐 나갈 것인가?",
      opt('🔍 정보를 수집하고, 증거를 논리적으로 조합하여 음모의 주동자를 밝혀낸다.', {logical:14, linguistic: 6}),
      opt('👥 주변 사람들의 심리를 파악하고, 신뢰할 수 있는 동료를 모은다.', {interpersonal:16}),
      opt('🏃‍♀️ 직접 몸을 숨겨 음모를 피하고, 반격의 기회를 노린다.', {bodily:12, spatial: 6}),
      opt('🤫 음모가 드러나기 전에 먼저 그들의 약점을 찾아내어 설득한다.', {interpersonal:14, linguistic: 8})
    ),
    q("미로의 숲", "마법에 걸린 숲에 갇혔다. 숲은 끊임없이 형태를 바꾸는 미로가 되어 길을 찾기 어렵다.",
      opt('🎼 숲에서 들려오는 신비한 새소리의 음계를 분석하여 길을 찾는다.', {musical:14, logical: 6}),
      opt('🌳 숲의 식물들과 교감하여 길을 물어본다.', {naturalist:14}),
      opt('� 숲의 패턴을 머릿속에 시각화하며 길을 찾는다.', {spatial:16}),
      opt('🗺️ 지형을 파악하고 돌이나 나뭇가지로 이정표를 만들어 길을 기록한다.', {spatial:12, bodily: 6})
    ),
    q("병든 정원", "어머니께서 아끼시던 정원이 병에 걸렸다. 정원을 되살리기 위해서는 특별한 힘이 필요하다.",
      opt('🌿 정원의 식물들을 하나하나 살피며 병의 원인을 분석한다.', {naturalist:14, logical: 6}),
      opt('💧 정원에 흐르는 물의 리듬에 맞춰 치유의 노래를 불러준다.', {musical:14}),
      opt('📚 오래된 정원 관리 일지를 찾아 기록을 분석한다.', {linguistic:12, naturalist: 6}),
      opt('🧚‍♀️ 정령들과 교감하며 도움을 요청한다.', {interpersonal:12, naturalist: 8})
    ),
    q("밤하늘의 별", "밤하늘에 나타난 예언의 별자리를 해석해야 한다. 그 의미를 어떻게 알 수 있을까?",
      opt('💫 별들의 위치와 움직임을 정교하게 관찰하고 기록한다.', {spatial:14, logical: 8}),
      opt('📖 오래된 천문학 서적을 찾아 별자리에 대한 전설을 해독한다.', {linguistic:12, spatial: 6}),
      opt('🧘‍♀️ 별빛의 에너지를 느끼며 내면의 지혜를 통해 의미를 깨닫는다.', {intrapersonal:14}),
      opt('🎶 별들이 만드는 소리의 파동을 듣고 그 의미를 이해한다.', {musical:10, intrapersonal: 6})
    )
  ],
  warrior: [
      q("불타는 마을", "평화롭던 산골 마을이 원인 모를 화염에 휩싸였다. 비명과 연기 속에서, 당신은 본능적으로 검을 쥐었다. 무엇을 가장 먼저 해야 하는가?",
      opt('🔥 사람들을 안전한 강가로 신속히 이끌며 대피시킨다.',{bodily:16,interpersonal:8}),
      opt('🚒 불길이 번지는 방향과 속도를 분석하여 효과적인 진압 계획을 세운다.',{logical:12}),
      opt('🏡 무너지는 집에서 미처 빠져나오지 못한 아이를 구하기 위해 뛰어든다.',{bodily:14, intrapersonal: 6}),
      opt('💧 주변의 나무를 베어 방화선을 만들고, 물을 길어 불을 끈다.',{naturalist:12,spatial:6})
    ),
    q("야생의 짐승", "평화로운 숲에 사나운 짐승이 나타나 주민들을 위협하고 있다. 짐승을 제압하여 마을의 평화를 되찾아야 한다.",
      opt('⚔️ 짐승의 움직임을 파악하고 민첩한 움직임으로 제압한다.', {bodily:16, logical: 6}),
      opt('🗣️ 짐승과 직접 교감하여 그 분노의 원인을 파악한다.', {interpersonal:14, naturalist: 6}),
      opt('🐾 짐승의 이동 경로를 분석해 함정을 설치한다.', {spatial:12, logical: 8}),
      opt('🌳 짐승의 서식지를 파괴하지 않고 자연 친화적인 해결책을 찾는다.', {naturalist:14})
    ),
    q("절벽의 동굴", "전설의 검이 숨겨져 있다는 절벽의 동굴에 도착했다. 동굴은 좁고 위험한 통로로 가득하다. 어떻게 나아갈 것인가?",
      opt('🧗‍♀️ 위험한 절벽을 타고 올라가 신체 능력을 활용해 통과한다.', {bodily:16, spatial: 6}),
      opt('🔦 동굴 내부의 지도를 머릿속에 그리고 최단 경로를 찾는다.', {spatial:14}),
      opt('🎶 동굴에서 들려오는 미세한 바람 소리의 리듬을 따라간다.', {musical:12, intrapersonal: 6}),
      opt('🧘‍♂️ 두려움을 극복하고 침착하게 한 걸음씩 나아간다.', {intrapersonal:14})
    ),
    q("잊혀진 언어", "오래된 석판에 잊혀진 언어로 된 전투 지침이 새겨져 있다. 이 지침을 해독해야 한다.",
      opt('📜 석판의 언어를 해독하여 문법적 규칙을 파악한다.', {linguistic:16}),
      opt('🧩 암호를 논리적으로 분석하여 해독한다.', {logical:14, linguistic: 8}),
      opt('⚔️ 몸으로 직접 지침의 동작을 따라하며 그 의미를 깨우친다.', {bodily:12, intrapersonal: 6}),
      opt('👥 학자들을 모아 함께 해독 작업에 착수한다.', {interpersonal:12, linguistic: 6})
    ),
    q("전장의 노래", "전의를 잃어버린 동료들을 위해 무엇을 할 것인가?",
      opt('🎤 용기를 북돋아 줄 승리의 노래를 불러준다.', {musical:14, interpersonal: 8}),
      opt('🗣️ 동료들의 마음을 다독이는 연설로 사기를 진작시킨다.', {linguistic:12, interpersonal: 10}),
      opt('💪 동료들과 함께 훈련하며 전투 기술을 연마한다.', {bodily:14, interpersonal: 8}),
      opt('🧘‍♂️ 스스로의 내면을 다스리고 평정을 유지하여 동료들의 본보기가 된다.', {intrapersonal:16})
    ),
    q("숲의 수호자", "숲의 수호자로 불리는 고대 거목이 병들었다. 거목을 치료해야 한다.",
      opt('🌳 거목의 상태를 자세히 관찰하고, 흙과 물의 상태를 파악한다.', {naturalist:14, logical: 6}),
      opt('🖐️ 거목의 표면에 손을 대고 그 고통을 직접 느낀다.', {intrapersonal:12, bodily: 8}),
      opt('🌿 거목 주변의 식물들을 분석하여 치료에 필요한 약초를 찾는다.', {naturalist:16}),
      opt('🧭 숲의 기운을 따라 거목이 필요로 하는 것을 찾아낸다.', {spatial:12, naturalist: 8})
    )
  ],
  wizard: [
    q("고대의 봉인", "스승님의 유품인 '지식의 탑' 입구가 기이한 문양의 봉인으로 막혀있다. 봉인은 미세한 마력으로 진동하고 있다. 이 수수께끼를 어떻게 풀 것인가?",
      opt('📖 봉인에 새겨진 고대 룬 문자의 배열과 문법적 규칙을 분석한다.',{linguistic:14}),
      opt('🧩 문양의 기하학적 패턴과 대칭성을 파악하여 논리적 해법을 찾는다.',{logical:16,spatial:6}),
      opt('✋ 손을 대고 마력의 흐름과 진동을 직접 느끼며 구조의 약점을 찾는다.',{bodily:10,intrapersonal:8}),
      opt('🍄 봉인 주변에만 자라는 특이한 이끼를 단서로, 자연 마법적 해법을 모색한다.',{naturalist:12})
    ),
    q("잃어버린 마법서", "전설적인 마법서가 사라졌다. 마법서의 행방을 추적하여 되찾아야 한다.",
      opt('🗺️ 마법서가 남긴 마력의 흔적을 추적하며 지도를 그린다.', {spatial:14, logical: 8}),
      opt('🗣️ 마법서와 관련된 사람들을 만나 정보를 수집한다.', {interpersonal:12, linguistic: 6}),
      opt('🤔 마법사가 남긴 단서들을 논리적으로 추리한다.', {logical:14}),
      opt('🧘‍♀️ 마법서가 마지막으로 있던 장소에서 명상하며 마법서의 기운을 느낀다.', {intrapersonal:14})
    ),
    q("환상의 숲", "신비한 환상의 숲에 들어왔다. 숲은 보는 사람의 마음을 현혹하여 길을 잃게 만든다.",
      opt('🧠 숲의 환영을 논리적으로 분석하여 진짜와 가짜를 구별한다.', {logical:16}),
      opt('🎶 숲에서 들려오는 신비로운 음악을 분석하여 환상의 원리를 파악한다.', {musical:14, logical: 6}),
      opt('🌳 숲의 식물들과 교감하여 환상을 깨는 방법을 찾는다.', {naturalist:12, interpersonal: 8}),
      opt('🧘‍♂️ 내면의 혼란을 다스리고 평정심을 유지하여 환상을 이겨낸다.', {intrapersonal:14})
    ),
    q("시간의 모래시계", "시간을 되돌리는 힘을 가진 모래시계를 찾았다. 하지만 시계는 복잡한 암호로 봉인되어 있다.",
      opt('📜 모래시계에 새겨진 고대 문자를 해독하여 암호를 푼다.', {linguistic:14, logical: 6}),
      opt('⏳ 시계의 모래가 떨어지는 리듬과 패턴을 분석한다.', {musical:12, logical: 8}),
      opt('✋ 모래시계의 구조를 직접 만지고 움직여 봉인을 해제한다.', {bodily:10, spatial: 8}),
      opt('🔮 모래시계가 가진 시간의 기운과 동화되어 암호를 파악한다.', {intrapersonal:14})
    ),
    q("어둠의 주문", "위험한 어둠의 주문이 담긴 책을 발견했다. 이 주문을 파괴하려면 어떻게 해야 할까?",
      opt('✍️ 주문의 내용을 분석하고, 그 의미를 정확히 파악하여 파괴의 주문을 만든다.', {linguistic:14, logical: 8}),
      opt('🔥 주문이 적힌 페이지를 불태워 버린다.', {bodily:10, intrapersonal: 6}),
      opt('🎶 주문의 리듬을 거스르는 반대 주문을 작곡하여 무효화한다.', {musical:16}),
      opt('👥 다른 마법사들과 협력하여 주문을 봉인한다.', {interpersonal:14, logical: 6})
    ),
    q("정령의 숲", "마법의 정령들이 사는 숲에 도착했다. 정령들은 인간을 경계하며 모습을 드러내지 않는다.",
      opt('🌳 숲의 나무와 동물들의 상태를 관찰하며 정령의 존재를 파악한다.', {naturalist:14}),
      opt('🗣️ 숲의 언어를 사용하여 정령들에게 말을 건다.', {linguistic:12, interpersonal: 10}),
      opt('🎶 정령들을 위한 아름다운 음악을 연주하여 마음을 연다.', {musical:14, interpersonal: 8}),
      opt('🧘‍♀️ 고요히 앉아 정령들의 기운을 느끼며 소통한다.', {intrapersonal:16})
    )
  ]
};

/* ====== 초기화 및 상태 관리 함수 ====== */
function resetGame() {
    scores = JSON.parse(JSON.stringify(baseScores));
    player = {name:'', clazz:'', charId:'', questIndex:0};
    document.querySelectorAll('.char').forEach(c => c.classList.remove('selected'));
    
    el('game-area').style.display = 'none';
    el('result-area').style.display = 'none';
    el('pre-game').style.display = 'block';
    el('stats-panel').style.display = 'none';
    
    el('input-name').value = '';
    el('input-class').value = '';
    
    el('start-btn-text').style.display = 'inline';
    el('start-btn-spinner').style.display = 'none';

    checkStartButton();
}

function checkStartButton() {
    const name = el('input-name').value.trim();
    const clazz = el('input-class').value.trim();
    const isCharSelected = !!player.charId;
    el('btn-start').disabled = !(name && clazz && isCharSelected);
}

// 이벤트 리스너: 캐릭터 선택
document.querySelectorAll('.char').forEach(node => {
    node.addEventListener('click', () => {
        document.querySelectorAll('.char').forEach(c => c.classList.remove('selected'));
        node.classList.add('selected');
        player.charId = node.dataset.id;
        checkStartButton();
    });
});

// 이벤트 리스너: 입력 필드 변경
el('input-name').addEventListener('input', checkStartButton);
el('input-class').addEventListener('input', checkStartButton);

// 이벤트 리스너: 게임 시작 버튼
el('btn-start').addEventListener('click', () => {
    const name = el('input-name').value.trim();
    const clazz = el('input-class').value.trim();
    
    if (name && clazz && player.charId) {
        player.name = name;
        player.clazz = clazz;
        player.questIndex = 0;
        
        el('start-btn-text').style.display = 'none';
        el('start-btn-spinner').style.display = 'block';
        
        // BGM 재생 (사용자 상호작용 후)
        sounds.bgm.play().catch(e => console.log("BGM 자동재생이 차단되었습니다."));
        
        setTimeout(() => {
            el('pre-game').style.display = 'none';
            el('game-area').style.display = 'block';
            el('stats-panel').style.display = 'block';
            renderQuest();
            el('start-btn-text').style.display = 'inline';
            el('start-btn-spinner').style.display = 'none';
        }, 1000);
    }
});

// 이벤트 리스너: 다시 시작 버튼
el('btn-restart').addEventListener('click', resetGame);

/* ====== 게임 렌더링 및 진행 함수 ====== */
function typeWriter(element, text, callback) {
    let i = 0;
    element.innerHTML = '';
    function typing() {
        if (i < text.length) {
            element.innerHTML += text.charAt(i);
            i++;
            setTimeout(typing, 30);
        } else if (callback) {
            callback();
        }
    }
    typing();
}

function renderQuest(){
    const list = quests[player.charId];
    if(!list || player.questIndex >= list.length){
        showResult();
        return;
    }

    const q = list[player.questIndex];
    const optRoot = el('options');
    optRoot.innerHTML = '';
    
    el('quest-title').textContent = `📜 Chapter ${player.questIndex + 1}: ${q.title}`;
    
    typeWriter(el('quest-text'), q.text, () => {
        q.options.forEach((o, i) => {
            const div = document.createElement('div');
            div.className = 'option';
            div.innerHTML = `<div class="label">${o.t}</div>`;
            div.onclick = () => {
                sounds.turn.currentTime = 0;
                sounds.turn.play();
                optRoot.style.pointerEvents = 'none'; // 중복 클릭 방지
                div.style.backgroundColor = 'rgba(112, 83, 48, 0.4)';
                applyEffects(o.e);
                player.questIndex++;
                setTimeout(() => {
                    renderQuest();
                    optRoot.style.pointerEvents = 'auto';
                }, 1000);
            };
            optRoot.appendChild(div);
        });
    });
    renderStats();
}

function applyEffects(e){
    Object.keys(e).forEach(k => {
        if(scores[k] !== undefined) scores[k] += e[k];
    });
}

function renderStats(){
    const root = el('stats');
    root.innerHTML = '';
    const mapNames = {linguistic:'언어',logical:'논리',spatial:'공간',bodily:'신체',musical:'음악',interpersonal:'인간관계',intrapersonal:'자기성찰',naturalist:'자연친화'};
    Object.keys(scores).forEach(k => {
        const score = Math.min(100, Math.max(0, scores[k]));
        const box = document.createElement('div');
        box.className = 'stat';
        box.innerHTML = `
            <div style="font-weight:bold;color:var(--gold)">${mapNames[k]}</div>
            <div class="bar"><div class="bar-inner" style="width:${score}%)"></div></div>
        `;
        root.appendChild(box);
    });
}

function showResult(){
    el('game-area').style.display = 'none';
    el('stats-panel').style.display = 'none';
    el('result-area').style.display = 'block';

    const entries = Object.entries(scores).sort((a,b)=>b[1]-a[1]);
    const top1 = entries[0][0];
    const top2 = entries[1][0];
    const mapNames = {linguistic:'언어 지능',logical:'논리-수학 지능',spatial:'공간 지능',bodily:'신체-운동 지능',musical:'음악 지능',interpersonal:'대인관계 지능',intrapersonal:'자기이해 지능',naturalist:'자연친화 지능'};
    
    const resultHTML = `
        <h3>📜 모험의 결과</h3>
        <p><strong>${player.name}</strong>(${player.clazz}) 모험가님, 기나긴 여정이 끝났습니다.</p>
        <p>당신의 선택은 다음과 같은 위대한 지능을 드러냈습니다.</p>
        <h4 style="color: var(--gold);">🥇 1순위: ${mapNames[top1]}</h4>
        <h4 style="color: #a4824a;">🥈 2순위: ${mapNames[top2]}</h4>
        <p style="margin-top: 20px;">이 지능들은 당신의 특별한 재능입니다. 앞으로의 진정한 모험은 이제부터 시작입니다!</p>
    `;
    el('result-content').innerHTML = resultHTML;
}

// 초기 게임 상태 설정
resetGame();

</script>
</body>
</html>
�
